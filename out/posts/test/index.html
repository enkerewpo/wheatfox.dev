<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><title>JR-Granular - JUCE &amp; RNBO C++ Export</title><link rel="icon" href="favicon.png"/><meta property="og:title" content="JR-Granular - JUCE &amp; RNBO C++ Export"/><meta property="og:site_name" content="wheatfox"/><meta property="og:image" content="https://wheatfox.art/images/jr-granular/jr-granular.png"/><meta property="og:image:width" content="1200"/><meta property="og:image:height" content="630"/><meta name="twitter:card" content="summary_large_image"/><meta name="next-head-count" content="10"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin /><link rel="preload" href="/_next/static/css/b224dec222690cac.css" as="style"/><link rel="stylesheet" href="/_next/static/css/b224dec222690cac.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-59c5c889f52620d6.js" defer=""></script><script src="/_next/static/chunks/framework-2c79e2a64abdb08b.js" defer=""></script><script src="/_next/static/chunks/main-a65df7aa2347953e.js" defer=""></script><script src="/_next/static/chunks/pages/_app-719ee7e4f001d483.js" defer=""></script><script src="/_next/static/chunks/d7eeaac4-62e432a9f5a13a1f.js" defer=""></script><script src="/_next/static/chunks/252f366e-52fc725a3b4547f9.js" defer=""></script><script src="/_next/static/chunks/409-f7e8803dc330a848.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bid%5D-4d5aa7c650688a5b.js" defer=""></script><script src="/_next/static/8XfhgVM-SIvD1zCQSXMJe/_buildManifest.js" defer=""></script><script src="/_next/static/8XfhgVM-SIvD1zCQSXMJe/_ssgManifest.js" defer=""></script><style data-href="https://fonts.googleapis.com/css2?family=Jost:wght@400;500&display=swap">@font-face{font-family:'Jost';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/jost/v14/92zPtBhPNqw79Ij1E865zBUv7myjJQVF.woff) format('woff')}@font-face{font-family:'Jost';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/jost/v14/92zPtBhPNqw79Ij1E865zBUv7myRJQVF.woff) format('woff')}@font-face{font-family:'Jost';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/jost/v14/92zatBhPNqw73oDd4jQmfxIC7w.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Jost';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/jost/v14/92zatBhPNqw73ord4jQmfxIC7w.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Jost';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/jost/v14/92zatBhPNqw73oTd4jQmfxI.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Jost';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/jost/v14/92zatBhPNqw73oDd4jQmfxIC7w.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Jost';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/jost/v14/92zatBhPNqw73ord4jQmfxIC7w.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Jost';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/jost/v14/92zatBhPNqw73oTd4jQmfxI.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}</style></head><body><div id="__next"><header class="py-5 border-b border-matteBlack sticky top-0 bg-cream bg-opacity-90 z-10"><div class="container px-6 lg:px-12 mx-auto flex items-center"><a class="text-matteBlack text-2xl font-semibold" href="/">wheatfox</a><div class="flex ml-auto"><a class="text-midGrey mr-5 text-2xl hover:text-matteBlack" href="https://github.com/enkerewpo"><span></span></a></div></div></header><main class="container m-auto"><div class="w-11/12 mt-16 mb-8 md:mt-24 md:mb-16 mx-auto text-center"><h1 class="mb-6">JR-Granular - JUCE &amp; RNBO C++ Export</h1><div class="flex items-center justify-center text-midGrey mt-12 text-sm"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" class="mr-1 text-base" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M21 10.12h-6.78l2.74-2.82c-2.73-2.7-7.15-2.8-9.88-.1-2.73 2.71-2.73 7.08 0 9.79 2.73 2.71 7.15 2.71 9.88 0C18.32 15.65 19 14.08 19 12.1h2c0 1.98-.88 4.55-2.64 6.29-3.51 3.48-9.21 3.48-12.72 0-3.5-3.47-3.53-9.11-.02-12.58 3.51-3.47 9.14-3.47 12.65 0L21 3v7.12zM12.5 8v4.25l3.5 2.08-.72 1.21L11 13V8h1.5z"></path></svg><time dateTime="2022-11-23">Nov 23, 2022</time><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024" class="ml-5 mr-1" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M880 184H712v-64c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v64H384v-64c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v64H144c-17.7 0-32 14.3-32 32v664c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V216c0-17.7-14.3-32-32-32zm-40 656H184V460h656v380zM184 392V256h128v48c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-48h256v48c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-48h128v136H184z"></path></svg><time dateTime="2022-11-02">Nov 2, 2022</time></div></div><div class="flex justify-center"><article class="w-11/12 lg:w-3/5 xl:w-1/2 xl:ml-16"><div class="post"><h2 id="introduction">Introduction</h2>
<p><img src="/images/jr-granular/jr-granular.png" alt="jr-granular.png"></p>
<p>In this tutorial I will show you how to make <a href="https://github.com/szkkng/jr-granular">JR-Granular</a>, a real-time granular fx plugin, with
RNBO C++ export and JUCE. In particular, I will focus on the following:</p>
<ul>
<li>how to do the RNBO C++ export</li>
<li>how to connect the exported code and JUCE using <a href="https://docs.juce.com/master/classAudioProcessorValueTreeState.html">APVTS</a></li>
<li>how to make custom UIs with JUCE</li>
</ul>
<p>Let's get started.</p>
<h3 id="prerequisites">Prerequisites</h3>
<ul>
<li>Install Xcode Command Line Tools by running "xcode-select --install".</li>
<li>Download and install <a href="https://cmake.org/download/">CMake</a> by running "brew install cmake".</li>
<li>Get Projucer by downloading <a href="https://juce.com/get-juce/download">JUCE</a>.</li>
</ul>
<h2 id="making-rnbo-granularmaxpat">Making rnbo-granular.maxpat</h2>
<p>In this chapter we will quickly implement a real-time granular fx using the gen~ codebox.</p>
<ol>
<li>Create a rnbo~ object.</li>
</ol>
<p><img src="/images/jr-granular/create-rnbo-object.png" alt="create-rnbo-object.png"></p>
<ol start="2">
<li>Create a gen~ object in the rnbo patcher</li>
</ol>
<p><img src="/images/jr-granular/create-gen-object.png" alt="create-gen-object.png"></p>
<ol start="3">
<li>Create a codebox object in the gen patcher</li>
</ol>
<p><img src="/images/jr-granular/create-codebox.png" alt="create-codebox.png"></p>
<ol start="4">
<li>Copy the following gen code and paste it into the codebox.</li>
</ol>
<p><img src="/images/jr-granular/codebox.png" alt="codebox.png"></p>
<div class="rehype-code-title">codebox</div><pre><code class="hljs language-c++"><span class="hljs-function">Param <span class="hljs-title">interval</span><span class="hljs-params">(<span class="hljs-number">100</span>)</span></span>;
<span class="hljs-function">Param <span class="hljs-title">grainSize</span><span class="hljs-params">(<span class="hljs-number">100</span>)</span></span>;
<span class="hljs-function">Param <span class="hljs-title">grainPos</span><span class="hljs-params">(<span class="hljs-number">100</span>)</span></span>;
<span class="hljs-function">Param <span class="hljs-title">width</span><span class="hljs-params">(<span class="hljs-number">0.5</span>)</span></span>;
<span class="hljs-function">Param <span class="hljs-title">pitch</span><span class="hljs-params">(<span class="hljs-number">0</span>)</span></span>;
<span class="hljs-function">Param <span class="hljs-title">mix</span><span class="hljs-params">(<span class="hljs-number">0.5</span>)</span></span>;
<span class="hljs-function">Param <span class="hljs-title">gain</span><span class="hljs-params">(<span class="hljs-number">0</span>)</span></span>;

<span class="hljs-function">Delay <span class="hljs-title">del_inL</span><span class="hljs-params">(samplerate * <span class="hljs-number">2</span>)</span></span>;
<span class="hljs-function">Delay <span class="hljs-title">del_inR</span><span class="hljs-params">(samplerate * <span class="hljs-number">2</span>)</span></span>;

<span class="hljs-function">Data <span class="hljs-title">data_param</span><span class="hljs-params">(<span class="hljs-number">6</span>, <span class="hljs-number">100</span>)</span></span>;

<span class="hljs-function">History <span class="hljs-title">his_index</span><span class="hljs-params">(<span class="hljs-number">0</span>)</span></span>;
<span class="hljs-function">History <span class="hljs-title">his_mix</span><span class="hljs-params">(<span class="hljs-number">0</span>)</span>, <span class="hljs-title">his_gain</span><span class="hljs-params">(<span class="hljs-number">0</span>)</span></span>;

his_mix = (mix - his_mix) * <span class="hljs-number">0.001</span> + his_mix;
his_gain = (gain - his_gain) * <span class="hljs-number">0.001</span> + his_gain;

maxVoice = <span class="hljs-number">100</span>;

del_inL.<span class="hljs-built_in">write</span>(in1);
del_inR.<span class="hljs-built_in">write</span>(in2);

mCout = <span class="hljs-built_in">counter</span>(<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-built_in">mstosamps</span>(interval));
<span class="hljs-keyword">if</span> (mCout == <span class="hljs-number">1</span>) {
	<span class="hljs-keyword">if</span> (<span class="hljs-built_in">peek</span>(data_param, <span class="hljs-number">0</span>, his_index) == <span class="hljs-number">0</span>) {
		<span class="hljs-built_in">poke</span>(data_param, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, his_index);
		<span class="hljs-built_in">poke</span>(data_param, <span class="hljs-built_in">mstosamps</span>(grainSize), <span class="hljs-number">1</span>, his_index);
		sizeScaled = <span class="hljs-built_in">mstosamps</span>(grainSize);
		widthRand = <span class="hljs-built_in">noise</span>() * <span class="hljs-number">0.5</span> * width;
		<span class="hljs-built_in">poke</span>(data_param, <span class="hljs-number">0.5</span> + widthRand, <span class="hljs-number">3</span>, his_index);
		<span class="hljs-built_in">poke</span>(data_param, <span class="hljs-number">0.5</span> - widthRand, <span class="hljs-number">4</span>, his_index);
		pitchScaled = <span class="hljs-built_in">pow</span>(<span class="hljs-number">2</span>, pitch / <span class="hljs-number">12</span>) - <span class="hljs-number">1</span>;
		<span class="hljs-built_in">poke</span>(data_param, pitchScaled, <span class="hljs-number">5</span>, his_index);
		his_index = <span class="hljs-built_in">wrap</span>(his_index + <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, maxVoice);
		posScaled = <span class="hljs-built_in">mstosamps</span>(grainPos) * <span class="hljs-built_in">abs</span>(<span class="hljs-built_in">noise</span>());
		<span class="hljs-built_in">poke</span>(data_param, posScaled + <span class="hljs-built_in">max</span>(sizeScaled*pitchScaled, <span class="hljs-number">0</span>), <span class="hljs-number">2</span>, his_index);
	}
}

outL = <span class="hljs-number">0</span>;
outR = <span class="hljs-number">0</span>;
totalWin = <span class="hljs-number">0</span>;
<span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &#x3C; maxVoice; i += <span class="hljs-number">1</span>) {
	pCout = <span class="hljs-built_in">peek</span>(data_param, <span class="hljs-number">0</span>, i);
	<span class="hljs-keyword">if</span> (pCout != <span class="hljs-number">0</span>) {
		s = <span class="hljs-built_in">peek</span>(data_param, <span class="hljs-number">1</span>, i);
		<span class="hljs-keyword">if</span> (pCout &#x3C; s) {
			pCoutScaled = pCout / s;
			win = <span class="hljs-number">0.5</span> * (<span class="hljs-built_in">sin</span> (<span class="hljs-number">1.5</span> * PI + pCoutScaled * TWOPI) + <span class="hljs-number">1</span>);
			outputL = del_inL.<span class="hljs-built_in">read</span>(<span class="hljs-built_in">peek</span>(data_param, <span class="hljs-number">2</span>, i) - pCout * <span class="hljs-built_in">peek</span>(data_param, <span class="hljs-number">5</span>, i)) * win;
			outputR = del_inR.<span class="hljs-built_in">read</span>(<span class="hljs-built_in">peek</span>(data_param, <span class="hljs-number">2</span>, i) - pCout * <span class="hljs-built_in">peek</span>(data_param, <span class="hljs-number">5</span>, i)) * win;
			outL += outputL * <span class="hljs-built_in">peek</span>(data_param, <span class="hljs-number">3</span>, i);
			outR += outputR * <span class="hljs-built_in">peek</span>(data_param, <span class="hljs-number">4</span>, i);
			<span class="hljs-built_in">poke</span>(data_param, pCout + <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, i);
			totalWin += win;
		} <span class="hljs-keyword">else</span> {
			<span class="hljs-built_in">poke</span>(data_param, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, i);
		}
	}
}

normalise = <span class="hljs-built_in">pow</span>(<span class="hljs-number">1</span> / <span class="hljs-built_in">max</span>(totalWin, <span class="hljs-number">1</span>), <span class="hljs-number">0.3</span>) * his_gain;
out1 = <span class="hljs-built_in">mix</span>(in1, outL * normalise, his_mix);
out2 = <span class="hljs-built_in">mix</span>(in2, outR * normalise, his_mix);
</code></pre>
<ol start="5">
<li>Finally, create param and setparam objects as shown below:</li>
</ol>
<p><img src="/images/jr-granular/gen-and-others.png" alt="gen-and-others.png"></p>
<h2 id="setting-up-a-juce-project">Setting up a JUCE project</h2>
<p>First, open Projucer and create a new project named JRGranular to generate the template files PluginProcessor.h/cpp and PluginEditor.h/cpp.
We will build our projects using CMake, so we will not use Projucer anymore.</p>
<p><img src="/images/jr-granular/new-project.png" alt="new-project.png"></p>
<p>Go to the project directory and delete unnecessary files.</p>
<div class="rehype-code-title">CommandLine</div><pre><code class="hljs language-text">$ cd ~/Desktop/JRGranular
$ rm -rf Builds JuceLibraryCode JRGranular.jucer
</code></pre>
<p>Add JUCE v7.0.2 to the project with the following command:</p>
<div class="rehype-code-title">CommandLine</div><pre><code class="hljs language-text">$ git init
$ git submodule add https://github.com/juce-framework/JUCE.git External/JUCE
$ cd External/JUCE
$ git checkout 7.0.2
$ cd -
</code></pre>
<p>Create RnboExport directory for RNBO C++ export destination.</p>
<div class="rehype-code-title">CommandLine</div><pre><code class="hljs language-text">$ mkdir RnboExport
</code></pre>
<p>Create a CMakeLists.txt file, copy and paste the following code into it</p>
<div class="rehype-code-title">CommandLine</div><pre><code class="hljs language-text">$ touch CMakeLists.txt
</code></pre>
<div class="rehype-code-title">CMakeLists.txt</div><pre><code class="hljs language-text">cmake_minimum_required(VERSION 3.21)

set(PROJECT_NAME "JR-Granular")
set(CMAKE_OSX_ARCHITECTURES "arm64;x86_64" CACHE STRING "Build architectures for macOS")
set(CMAKE_OSX_DEPLOYMENT_TARGET "10.11" CACHE STRING "Minimum macOS version required")

project("${PROJECT_NAME}" VERSION 1.0.0)

set(formats "VST3" "Standalone")

if(APPLE)
    list(APPEND formats "AU")
endif()

add_subdirectory(External/JUCE)

juce_add_plugin("${PROJECT_NAME}"
    VERSION "1.0.0"
    COMPANY_NAME "JR-Granular"
    PLUGIN_MANUFACTURER_CODE "Jrgn"
    PLUGIN_CODE "R001"
    FORMATS ${formats}
    COPY_PLUGIN_AFTER_BUILD TRUE
    IS_SYNTH FALSE     
    NEEDS_MIDI_INPUT FALSE
    NEEDS_MIDI_OUTPUT FALSE
    IS_MIDI_EFFECT FALSE
    PRODUCT_NAME "${PROJECT_NAME}")

juce_generate_juce_header("${PROJECT_NAME}")

include_directories(
    "${CMAKE_CURRENT_SOURCE_DIR}/RnboExport/rnbo"
    "${CMAKE_CURRENT_SOURCE_DIR}/RnboExport/rnbo/common")

target_sources("${PROJECT_NAME}"
    PRIVATE
        RnboExport/rnbo_granular.cpp
        RnboExport/rnbo/RNBO.cpp
        Source/PluginProcessor.cpp
        Source/PluginEditor.cpp)

target_compile_features("${PROJECT_NAME}" PUBLIC cxx_std_20)

target_compile_definitions("${PROJECT_NAME}"
    PUBLIC
        JUCE_WEB_BROWSER=0
        JUCE_USE_CURL=0
        JUCE_VST3_CAN_REPLACE_VST2=0)

target_link_libraries("${PROJECT_NAME}"
    PRIVATE
        juce::juce_audio_utils
        juce::juce_recommended_config_flags
        juce::juce_recommended_lto_flags
        juce::juce_recommended_warning_flags)
</code></pre>
<p>After these settings, your directory structure should look something like this:</p>
<p><img src="/images/jr-granular/directory-structure.png" alt="directories.png"></p>
<h2 id="rnbo-c-export">RNBO C++ Export</h2>
<p>Click on the export sidebar button located in the right toolbar, and select the C++ Source Code Export.</p>
<p><img src="/images/jr-granular/export-sidebar.png" alt="export-sidebar.png"></p>
<p>Click on the choose button to specify the RnboExport directory as the output directory.
<img src="/images/jr-granular/output-directory.png" alt="output-directory.png"></p>
<p>Change the Export Name and the Classname as follows:
<img src="/images/jr-granular/names.png" alt="names.png"></p>
<p>Click on the Export to Selected Target button at the bottom right of the window. If there are no error messages in the Export Log, you have succeeded.
<img src="/images/jr-granular/export.png" alt="export.png"></p>
<p>Return to the console and check that the project can be built successfully.</p>
<div class="rehype-code-title">CommandLine</div><pre><code class="hljs language-text">$ cmake -S . -B build -DCMAKE_BUILD_TYPE=Debug
$ cmake --build build --config Debug
</code></pre>
<p>Run the standalone with the following command. You should see "Hello, World".</p>
<div class="rehype-code-title">CommandLine</div><pre><code class="hljs language-text">$ build/JR-Granular_artefacts/Debug/Standalone/JR-Granular.app/Contents/MacOS/JR-Granular
</code></pre>
<p><img src="/images/jr-granular/hello-world.png" alt="hello-world.png"></p>
<h2 id="connecting-the-exported-code-with-juce">Connecting the exported code with JUCE</h2>
<p>This chapter explains how to link the exported c++ code with JUCE. My approach is to use <a href="https://docs.juce.com/master/classAudioProcessorValueTreeState.html">juce::AudioProcessorValueTreeState</a>.</p>
<h3 id="paramidsh">ParamIDs.h</h3>
<p>First, create the string IDs in ParamIDs.h, which are needed when creating JUCE apvts parameters and when linking the UI and DSP. I do this to prevent typing errors. The value of each variable must correspond to the value of "paramId" listed in the RnboExport/description.json.</p>
<div class="rehype-code-title">CommandLine</div><pre><code class="hljs language-text">$ touch Source/ParamIDs.h
</code></pre>
<div class="rehype-code-title">ParamIDs.h</div><pre><code class="hljs language-C++"><span class="hljs-meta">#<span class="hljs-keyword">pragma</span> once</span>

<span class="hljs-keyword">namespace</span> ParamIDs
{

    <span class="hljs-comment">// Be the same value as the "paramId" listed in the rnbo description.json.</span>
    <span class="hljs-keyword">inline</span> <span class="hljs-keyword">constexpr</span> <span class="hljs-keyword">auto</span> mix       { <span class="hljs-string">"mix"</span> };
    <span class="hljs-keyword">inline</span> <span class="hljs-keyword">constexpr</span> <span class="hljs-keyword">auto</span> gain      { <span class="hljs-string">"gain"</span> };
    <span class="hljs-keyword">inline</span> <span class="hljs-keyword">constexpr</span> <span class="hljs-keyword">auto</span> grainPos  { <span class="hljs-string">"grainPos"</span> };
    <span class="hljs-keyword">inline</span> <span class="hljs-keyword">constexpr</span> <span class="hljs-keyword">auto</span> grainSize { <span class="hljs-string">"grainSize"</span> };
    <span class="hljs-keyword">inline</span> <span class="hljs-keyword">constexpr</span> <span class="hljs-keyword">auto</span> interval  { <span class="hljs-string">"interval"</span> };
    <span class="hljs-keyword">inline</span> <span class="hljs-keyword">constexpr</span> <span class="hljs-keyword">auto</span> pitch     { <span class="hljs-string">"pitch"</span> };
    <span class="hljs-keyword">inline</span> <span class="hljs-keyword">constexpr</span> <span class="hljs-keyword">auto</span> width     { <span class="hljs-string">"width"</span> };

} <span class="hljs-comment">// namespace paramIDs</span>
</code></pre>
<h3 id="pluginprocessorhcpp">PluginProcessor.h/cpp</h3>
<p>PluginProcessor.h/cpp is as follows.</p>
<div class="rehype-code-title">PluginProcessor.h</div><pre><code class="hljs language-C++"><span class="hljs-meta">#<span class="hljs-keyword">pragma</span> once</span>

<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&#x3C;JuceHeader.h></span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"RNBO.h"</span></span>

<span class="hljs-keyword">class</span> <span class="hljs-title hljs-class">JRGranularAudioProcessor</span>  : <span class="hljs-keyword">public</span> juce::AudioProcessor,
                                  <span class="hljs-keyword">public</span> juce::AudioProcessorValueTreeState::Listener
{
<span class="hljs-keyword">public</span>:
    <span class="hljs-comment">//==============================================================================</span>
    <span class="hljs-built_in">JRGranularAudioProcessor</span>();
    ~<span class="hljs-built_in">JRGranularAudioProcessor</span>() <span class="hljs-keyword">override</span>;

    <span class="hljs-comment">//==============================================================================</span>
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">prepareToPlay</span> <span class="hljs-params">(<span class="hljs-type">double</span> sampleRate, <span class="hljs-type">int</span> samplesPerBlock)</span> <span class="hljs-keyword">override</span></span>;
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">releaseResources</span><span class="hljs-params">()</span> <span class="hljs-keyword">override</span></span>;

   <span class="hljs-meta">#<span class="hljs-keyword">ifndef</span> JucePlugin_PreferredChannelConfigurations</span>
    <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">isBusesLayoutSupported</span> <span class="hljs-params">(<span class="hljs-keyword">const</span> BusesLayout&#x26; layouts)</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">override</span></span>;
   <span class="hljs-meta">#<span class="hljs-keyword">endif</span></span>

    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">processBlock</span> <span class="hljs-params">(juce::AudioBuffer&#x3C;<span class="hljs-type">float</span>>&#x26;, juce::MidiBuffer&#x26;)</span> <span class="hljs-keyword">override</span></span>;

    <span class="hljs-comment">//==============================================================================</span>
    <span class="hljs-function">juce::AudioProcessorEditor* <span class="hljs-title">createEditor</span><span class="hljs-params">()</span> <span class="hljs-keyword">override</span></span>;
    <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">hasEditor</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">override</span></span>;

    <span class="hljs-comment">//==============================================================================</span>
    <span class="hljs-function"><span class="hljs-keyword">const</span> juce::String <span class="hljs-title">getName</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">override</span></span>;

    <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">acceptsMidi</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">override</span></span>;
    <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">producesMidi</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">override</span></span>;
    <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">isMidiEffect</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">override</span></span>;
    <span class="hljs-function"><span class="hljs-type">double</span> <span class="hljs-title">getTailLengthSeconds</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">override</span></span>;

    <span class="hljs-comment">//==============================================================================</span>
    <span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">getNumPrograms</span><span class="hljs-params">()</span> <span class="hljs-keyword">override</span></span>;
    <span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">getCurrentProgram</span><span class="hljs-params">()</span> <span class="hljs-keyword">override</span></span>;
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">setCurrentProgram</span> <span class="hljs-params">(<span class="hljs-type">int</span> index)</span> <span class="hljs-keyword">override</span></span>;
    <span class="hljs-function"><span class="hljs-keyword">const</span> juce::String <span class="hljs-title">getProgramName</span> <span class="hljs-params">(<span class="hljs-type">int</span> index)</span> <span class="hljs-keyword">override</span></span>;
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">changeProgramName</span> <span class="hljs-params">(<span class="hljs-type">int</span> index, <span class="hljs-keyword">const</span> juce::String&#x26; newName)</span> <span class="hljs-keyword">override</span></span>;

    <span class="hljs-comment">//==============================================================================</span>
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">getStateInformation</span> <span class="hljs-params">(juce::MemoryBlock&#x26; destData)</span> <span class="hljs-keyword">override</span></span>;
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">setStateInformation</span> <span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-type">void</span>* data, <span class="hljs-type">int</span> sizeInBytes)</span> <span class="hljs-keyword">override</span></span>;

    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">parameterChanged</span> <span class="hljs-params">(<span class="hljs-keyword">const</span> juce::String&#x26; parameterID, <span class="hljs-type">float</span> newValue)</span> <span class="hljs-keyword">override</span></span>;

<span class="hljs-keyword">private</span>:
    <span class="hljs-comment">//==============================================================================</span>
    juce::AudioProcessorValueTreeState apvts;
    juce::UndoManager undoManager;

    RNBO::CoreObject rnboObject;

    std::unordered_map&#x3C;juce::String, RNBO::ParameterIndex> apvtsParamIdToRnboParamIndex;

    <span class="hljs-built_in">JUCE_DECLARE_NON_COPYABLE_WITH_LEAK_DETECTOR</span> (JRGranularAudioProcessor)
};
</code></pre>
<div class="rehype-code-title">PluginProcessor.cpp</div><pre><code class="hljs language-C++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"PluginProcessor.h"</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"PluginEditor.h"</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"ParamIDs.h"</span></span>

<span class="hljs-keyword">static</span> juce::<span class="hljs-function">AudioProcessorValueTreeState::ParameterLayout <span class="hljs-title">createParameterLayout</span><span class="hljs-params">()</span>
</span>{
    juce::AudioProcessorValueTreeState::ParameterLayout layout;

    <span class="hljs-keyword">auto</span> msFormat = [](<span class="hljs-type">float</span> value, <span class="hljs-type">int</span>)
    {
        <span class="hljs-keyword">if</span> (value &#x3C; <span class="hljs-number">100.0f</span>)
            <span class="hljs-keyword">return</span> juce::<span class="hljs-built_in">String</span> (value, <span class="hljs-number">1</span>) + <span class="hljs-string">" ms"</span>;
        <span class="hljs-keyword">else</span>
            <span class="hljs-keyword">return</span> juce::<span class="hljs-built_in">String</span> (std::<span class="hljs-built_in">roundf</span> (value)) + <span class="hljs-string">" ms"</span>;
    };

    layout.<span class="hljs-built_in">add</span> (std::<span class="hljs-built_in">make_unique</span>&#x3C;juce::AudioParameterFloat> (juce::ParameterID { ParamIDs::interval, <span class="hljs-number">1</span> },
                                                             <span class="hljs-string">"intv"</span>,
                                                             juce::<span class="hljs-built_in">NormalisableRange</span>&#x3C;<span class="hljs-type">float</span>> (<span class="hljs-number">10.0f</span>, <span class="hljs-number">500.0f</span>, <span class="hljs-number">0.01f</span>, <span class="hljs-number">0.405f</span>),
                                                             <span class="hljs-number">100.0f</span>,
                                                             juce::<span class="hljs-built_in">String</span>(),
                                                             juce::AudioProcessorParameter::genericParameter,
                                                             msFormat,
                                                             <span class="hljs-literal">nullptr</span>));

    layout.<span class="hljs-built_in">add</span> (std::<span class="hljs-built_in">make_unique</span>&#x3C;juce::AudioParameterFloat> (juce::ParameterID { ParamIDs::pitch, <span class="hljs-number">1</span> }, 
                                                             ParamIDs::pitch,
                                                             juce::<span class="hljs-built_in">NormalisableRange</span>&#x3C;<span class="hljs-type">float</span>> (<span class="hljs-number">-12.0f</span>, <span class="hljs-number">12.0f</span>, <span class="hljs-number">0.1f</span>, <span class="hljs-number">1.0f</span>),
                                                             <span class="hljs-number">0.0f</span>,
                                                             juce::<span class="hljs-built_in">String</span>(),
                                                             juce::AudioProcessorParameter::genericParameter,
                                                             [](<span class="hljs-type">float</span> value, <span class="hljs-type">int</span>) {
                                                                <span class="hljs-keyword">return</span> juce::<span class="hljs-built_in">String</span> (value, <span class="hljs-number">1</span>) + <span class="hljs-string">" st"</span>; },
                                                             <span class="hljs-literal">nullptr</span>));

    layout.<span class="hljs-built_in">add</span> (std::<span class="hljs-built_in">make_unique</span>&#x3C;juce::AudioParameterFloat> (juce::ParameterID { ParamIDs::grainPos, <span class="hljs-number">1</span> }, 
                                                             <span class="hljs-string">"pos"</span>,
                                                             juce::<span class="hljs-built_in">NormalisableRange</span>&#x3C;<span class="hljs-type">float</span>> (<span class="hljs-number">10.0f</span>, <span class="hljs-number">500.0f</span>, <span class="hljs-number">1.0f</span>, <span class="hljs-number">0.405f</span>),
                                                             <span class="hljs-number">100.0f</span>,
                                                             juce::<span class="hljs-built_in">String</span>(),
                                                             juce::AudioProcessorParameter::genericParameter,
                                                             msFormat,
                                                             <span class="hljs-literal">nullptr</span>));

    layout.<span class="hljs-built_in">add</span> (std::<span class="hljs-built_in">make_unique</span>&#x3C;juce::AudioParameterFloat> (juce::ParameterID { ParamIDs::grainSize, <span class="hljs-number">1</span> }, 
                                                             <span class="hljs-string">"size"</span>,
                                                             juce::<span class="hljs-built_in">NormalisableRange</span>&#x3C;<span class="hljs-type">float</span>> (<span class="hljs-number">10.0f</span>, <span class="hljs-number">500.0f</span>, <span class="hljs-number">0.01f</span>, <span class="hljs-number">0.405f</span>),
                                                             <span class="hljs-number">100.0f</span>,
                                                             juce::<span class="hljs-built_in">String</span>(),
                                                             juce::AudioProcessorParameter::genericParameter,
                                                             msFormat,
                                                             <span class="hljs-literal">nullptr</span>));

    <span class="hljs-keyword">auto</span> percentFormat = [](<span class="hljs-type">float</span> value, <span class="hljs-type">int</span>)
    {
         <span class="hljs-keyword">if</span> (value &#x3C; <span class="hljs-number">10.0f</span>)
             <span class="hljs-keyword">return</span> juce::<span class="hljs-built_in">String</span> (value, <span class="hljs-number">2</span>) + <span class="hljs-string">" %"</span>;
         <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (value &#x3C; <span class="hljs-number">100.0f</span>)
             <span class="hljs-keyword">return</span> juce::<span class="hljs-built_in">String</span> (value, <span class="hljs-number">1</span>) + <span class="hljs-string">" %"</span>;
         <span class="hljs-keyword">else</span>
             <span class="hljs-keyword">return</span> juce::<span class="hljs-built_in">String</span> (value, <span class="hljs-number">0</span>) + <span class="hljs-string">" %"</span>; 
    };

    layout.<span class="hljs-built_in">add</span> (std::<span class="hljs-built_in">make_unique</span>&#x3C;juce::AudioParameterFloat> (juce::ParameterID { ParamIDs::mix, <span class="hljs-number">1</span> }, 
                                                             ParamIDs::mix,
                                                             juce::<span class="hljs-built_in">NormalisableRange</span>&#x3C;<span class="hljs-type">float</span>> (<span class="hljs-number">0.0f</span>, <span class="hljs-number">100.0f</span>, <span class="hljs-number">0.01f</span>, <span class="hljs-number">1.0f</span>),
                                                             <span class="hljs-number">50.0f</span>,
                                                             juce::<span class="hljs-built_in">String</span>(),
                                                             juce::AudioProcessorParameter::genericParameter,
                                                             percentFormat,
                                                             <span class="hljs-literal">nullptr</span>));

    layout.<span class="hljs-built_in">add</span> (std::<span class="hljs-built_in">make_unique</span>&#x3C;juce::AudioParameterFloat> (juce::ParameterID { ParamIDs::width, <span class="hljs-number">1</span> }, 
                                                             ParamIDs::width,
                                                             juce::<span class="hljs-built_in">NormalisableRange</span>&#x3C;<span class="hljs-type">float</span>> (<span class="hljs-number">0.0f</span>, <span class="hljs-number">100.0f</span>, <span class="hljs-number">0.01f</span>, <span class="hljs-number">1.0f</span>),
                                                             <span class="hljs-number">50.0</span>,
                                                             juce::<span class="hljs-built_in">String</span>(),
                                                             juce::AudioProcessorParameter::genericParameter,
                                                             percentFormat,
                                                             <span class="hljs-literal">nullptr</span>));

    layout.<span class="hljs-built_in">add</span> (std::<span class="hljs-built_in">make_unique</span>&#x3C;juce::AudioParameterFloat> (juce::ParameterID { ParamIDs::gain, <span class="hljs-number">1</span> }, 
                                                             <span class="hljs-string">"vol"</span>,
                                                             juce::<span class="hljs-built_in">NormalisableRange</span>&#x3C;<span class="hljs-type">float</span>> (<span class="hljs-number">-36.0f</span>, <span class="hljs-number">12.0f</span>, <span class="hljs-number">0.1f</span>, <span class="hljs-number">2.4f</span>),
                                                             <span class="hljs-number">0.0f</span>,
                                                             juce::<span class="hljs-built_in">String</span>(),
                                                             juce::AudioProcessorParameter::genericParameter,
                                                             [](<span class="hljs-type">float</span> value, <span class="hljs-type">int</span>) {
                                                             <span class="hljs-keyword">if</span> (<span class="hljs-number">-10.0f</span> &#x3C; value &#x26;&#x26; value &#x3C; <span class="hljs-number">10.0f</span>)
                                                                 <span class="hljs-keyword">return</span> juce::<span class="hljs-built_in">String</span> (value, <span class="hljs-number">1</span>) + <span class="hljs-string">" dB"</span>;
                                                             <span class="hljs-keyword">else</span>
                                                                 <span class="hljs-keyword">return</span> juce::<span class="hljs-built_in">String</span> (std::<span class="hljs-built_in">roundf</span> (value), <span class="hljs-number">0</span>) + <span class="hljs-string">" dB"</span>; },
                                                             <span class="hljs-literal">nullptr</span>));

    <span class="hljs-keyword">return</span> layout;
}

<span class="hljs-comment">//==============================================================================</span>
JRGranularAudioProcessor::<span class="hljs-built_in">JRGranularAudioProcessor</span>()
<span class="hljs-meta">#<span class="hljs-keyword">ifndef</span> JucePlugin_PreferredChannelConfigurations</span>
     : <span class="hljs-built_in">AudioProcessor</span> (<span class="hljs-built_in">BusesProperties</span>()
                     <span class="hljs-meta">#<span class="hljs-keyword">if</span> ! JucePlugin_IsMidiEffect</span>
                      <span class="hljs-meta">#<span class="hljs-keyword">if</span> ! JucePlugin_IsSynth</span>
                       .<span class="hljs-built_in">withInput</span>  (<span class="hljs-string">"Input"</span>,  juce::AudioChannelSet::<span class="hljs-built_in">stereo</span>(), <span class="hljs-literal">true</span>)
                      <span class="hljs-meta">#<span class="hljs-keyword">endif</span></span>
                       .<span class="hljs-built_in">withOutput</span> (<span class="hljs-string">"Output"</span>, juce::AudioChannelSet::<span class="hljs-built_in">stereo</span>(), <span class="hljs-literal">true</span>)
                     <span class="hljs-meta">#<span class="hljs-keyword">endif</span></span>
                       ),
<span class="hljs-meta">#<span class="hljs-keyword">endif</span></span>
       <span class="hljs-built_in">apvts</span> (*<span class="hljs-keyword">this</span>, &#x26;undoManager, <span class="hljs-string">"Parameters"</span>, <span class="hljs-built_in">createParameterLayout</span>())
{
    <span class="hljs-keyword">for</span> (RNBO::ParameterIndex i = <span class="hljs-number">0</span>; i &#x3C; rnboObject.<span class="hljs-built_in">getNumParameters</span>(); ++i)
    {
        RNBO::ParameterInfo info;
        rnboObject.<span class="hljs-built_in">getParameterInfo</span> (i, &#x26;info);

        <span class="hljs-keyword">if</span> (info.visible)
        {
            <span class="hljs-keyword">auto</span> paramID = juce::<span class="hljs-built_in">String</span> (rnboObject.<span class="hljs-built_in">getParameterId</span> (i));

            <span class="hljs-comment">// Each apvts parameter id and range must be the same as the rnbo param object's.</span>
            <span class="hljs-comment">// If you hit this assertion then you need to fix the incorrect id in ParamIDs.h.</span>
            <span class="hljs-built_in">jassert</span> (apvts.<span class="hljs-built_in">getParameter</span> (paramID) != <span class="hljs-literal">nullptr</span>);  

            <span class="hljs-comment">// If you hit these assertions then you need to fix the incorrect apvts </span>
            <span class="hljs-comment">// parameter range in createParameterLayout().</span>
            <span class="hljs-built_in">jassert</span> (info.min == apvts.<span class="hljs-built_in">getParameterRange</span> (paramID).start);
            <span class="hljs-built_in">jassert</span> (info.max == apvts.<span class="hljs-built_in">getParameterRange</span> (paramID).end);

            apvtsParamIdToRnboParamIndex[paramID] = i;

            apvts.<span class="hljs-built_in">addParameterListener</span> (paramID, <span class="hljs-keyword">this</span>);
            rnboObject.<span class="hljs-built_in">setParameterValue</span> (i, apvts.<span class="hljs-built_in">getRawParameterValue</span> (paramID)-><span class="hljs-built_in">load</span>());
        }
    }
}

JRGranularAudioProcessor::~<span class="hljs-built_in">JRGranularAudioProcessor</span>()
{
}

<span class="hljs-comment">//==============================================================================</span>
<span class="hljs-function"><span class="hljs-keyword">const</span> juce::String <span class="hljs-title">JRGranularAudioProcessor::getName</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span>
</span>{
    <span class="hljs-keyword">return</span> JucePlugin_Name;
}

<span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">JRGranularAudioProcessor::acceptsMidi</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span>
</span>{
   <span class="hljs-meta">#<span class="hljs-keyword">if</span> JucePlugin_WantsMidiInput</span>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
   <span class="hljs-meta">#<span class="hljs-keyword">else</span></span>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
   <span class="hljs-meta">#<span class="hljs-keyword">endif</span></span>
}

<span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">JRGranularAudioProcessor::producesMidi</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span>
</span>{
   <span class="hljs-meta">#<span class="hljs-keyword">if</span> JucePlugin_ProducesMidiOutput</span>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
   <span class="hljs-meta">#<span class="hljs-keyword">else</span></span>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
   <span class="hljs-meta">#<span class="hljs-keyword">endif</span></span>
}

<span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">JRGranularAudioProcessor::isMidiEffect</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span>
</span>{
   <span class="hljs-meta">#<span class="hljs-keyword">if</span> JucePlugin_IsMidiEffect</span>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
   <span class="hljs-meta">#<span class="hljs-keyword">else</span></span>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
   <span class="hljs-meta">#<span class="hljs-keyword">endif</span></span>
}

<span class="hljs-function"><span class="hljs-type">double</span> <span class="hljs-title">JRGranularAudioProcessor::getTailLengthSeconds</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span>
</span>{
    <span class="hljs-keyword">return</span> <span class="hljs-number">0.0</span>;
}

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">JRGranularAudioProcessor::getNumPrograms</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;   <span class="hljs-comment">// NB: some hosts don't cope very well if you tell them there are 0 programs,</span>
                <span class="hljs-comment">// so this should be at least 1, even if you're not really implementing programs.</span>
}

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">JRGranularAudioProcessor::getCurrentProgram</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">JRGranularAudioProcessor::setCurrentProgram</span> <span class="hljs-params">(<span class="hljs-type">int</span> index)</span>
</span>{
    juce::<span class="hljs-built_in">ignoreUnused</span> (index);
}

<span class="hljs-function"><span class="hljs-keyword">const</span> juce::String <span class="hljs-title">JRGranularAudioProcessor::getProgramName</span> <span class="hljs-params">(<span class="hljs-type">int</span> index)</span>
</span>{
    juce::<span class="hljs-built_in">ignoreUnused</span> (index);
    <span class="hljs-keyword">return</span> {};
}

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">JRGranularAudioProcessor::changeProgramName</span> <span class="hljs-params">(<span class="hljs-type">int</span> index, <span class="hljs-keyword">const</span> juce::String&#x26; newName)</span>
</span>{
    juce::<span class="hljs-built_in">ignoreUnused</span> (index, newName);
}

<span class="hljs-comment">//==============================================================================</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">JRGranularAudioProcessor::prepareToPlay</span> <span class="hljs-params">(<span class="hljs-type">double</span> sampleRate, <span class="hljs-type">int</span> samplesPerBlock)</span>
</span>{
    rnboObject.<span class="hljs-built_in">prepareToProcess</span> (sampleRate, <span class="hljs-built_in">static_cast</span>&#x3C;<span class="hljs-type">size_t</span>> (samplesPerBlock));
}

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">JRGranularAudioProcessor::releaseResources</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-comment">// When playback stops, you can use this as an opportunity to free up any</span>
    <span class="hljs-comment">// spare memory, etc.</span>
}

<span class="hljs-meta">#<span class="hljs-keyword">ifndef</span> JucePlugin_PreferredChannelConfigurations</span>
<span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">JRGranularAudioProcessor::isBusesLayoutSupported</span> <span class="hljs-params">(<span class="hljs-keyword">const</span> BusesLayout&#x26; layouts)</span> <span class="hljs-keyword">const</span>
</span>{
  <span class="hljs-meta">#<span class="hljs-keyword">if</span> JucePlugin_IsMidiEffect</span>
    juce::<span class="hljs-built_in">ignoreUnused</span> (layouts);
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
  <span class="hljs-meta">#<span class="hljs-keyword">else</span></span>
    <span class="hljs-comment">// This is the place where you check if the layout is supported.</span>
    <span class="hljs-comment">// In this template code we only support mono or stereo.</span>
    <span class="hljs-comment">// Some plugin hosts, such as certain GarageBand versions, will only</span>
    <span class="hljs-comment">// load plugins that support stereo bus layouts.</span>
    <span class="hljs-keyword">if</span> (layouts.<span class="hljs-built_in">getMainOutputChannelSet</span>() != juce::AudioChannelSet::<span class="hljs-built_in">mono</span>()
     &#x26;&#x26; layouts.<span class="hljs-built_in">getMainOutputChannelSet</span>() != juce::AudioChannelSet::<span class="hljs-built_in">stereo</span>())
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;

    <span class="hljs-comment">// This checks if the input layout matches the output layout</span>
   <span class="hljs-meta">#<span class="hljs-keyword">if</span> ! JucePlugin_IsSynth</span>
    <span class="hljs-keyword">if</span> (layouts.<span class="hljs-built_in">getMainOutputChannelSet</span>() != layouts.<span class="hljs-built_in">getMainInputChannelSet</span>())
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
   <span class="hljs-meta">#<span class="hljs-keyword">endif</span></span>

    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
  <span class="hljs-meta">#<span class="hljs-keyword">endif</span></span>
}
<span class="hljs-meta">#<span class="hljs-keyword">endif</span></span>

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">JRGranularAudioProcessor::processBlock</span> <span class="hljs-params">(juce::AudioBuffer&#x3C;<span class="hljs-type">float</span>>&#x26; buffer, juce::MidiBuffer&#x26; midiMessages)</span>
</span>{
    juce::<span class="hljs-built_in">ignoreUnused</span> (midiMessages);
    <span class="hljs-keyword">auto</span> bufferSize = buffer.<span class="hljs-built_in">getNumSamples</span>();

    rnboObject.<span class="hljs-built_in">prepareToProcess</span> (<span class="hljs-built_in">getSampleRate</span>(), 
                                 <span class="hljs-built_in">static_cast</span>&#x3C;<span class="hljs-type">size_t</span>> (bufferSize));

    rnboObject.<span class="hljs-built_in">process</span> (buffer.<span class="hljs-built_in">getArrayOfWritePointers</span>(),
                        <span class="hljs-built_in">static_cast</span>&#x3C;RNBO::Index> (buffer.<span class="hljs-built_in">getNumChannels</span>()),
                        buffer.<span class="hljs-built_in">getArrayOfWritePointers</span>(),
                        <span class="hljs-built_in">static_cast</span>&#x3C;RNBO::Index> (buffer.<span class="hljs-built_in">getNumChannels</span>()),
                        <span class="hljs-built_in">static_cast</span>&#x3C;RNBO::Index> (bufferSize));
}

<span class="hljs-comment">//==============================================================================</span>
<span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">JRGranularAudioProcessor::hasEditor</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span>
</span>{
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>; <span class="hljs-comment">// (change this to false if you choose to not supply an editor)</span>
}

<span class="hljs-function">juce::AudioProcessorEditor* <span class="hljs-title">JRGranularAudioProcessor::createEditor</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">JRGranularAudioProcessorEditor</span> (*<span class="hljs-keyword">this</span>, apvts, undoManager);
    <span class="hljs-comment">/* return new juce::GenericAudioProcessorEditor (*this); */</span>
}

<span class="hljs-comment">//==============================================================================</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">JRGranularAudioProcessor::getStateInformation</span> <span class="hljs-params">(juce::MemoryBlock&#x26; destData)</span>
</span>{
    <span class="hljs-function">juce::MemoryOutputStream <span class="hljs-title">mos</span> <span class="hljs-params">(destData, <span class="hljs-literal">true</span>)</span></span>;
    apvts.state.<span class="hljs-built_in">writeToStream</span> (mos);
}

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">JRGranularAudioProcessor::setStateInformation</span> <span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-type">void</span>* data, <span class="hljs-type">int</span> sizeInBytes)</span>
</span>{
    <span class="hljs-keyword">auto</span> tree = juce::ValueTree::<span class="hljs-built_in">readFromData</span> (data, <span class="hljs-built_in">static_cast</span>&#x3C;<span class="hljs-type">size_t</span>> (sizeInBytes));

    <span class="hljs-keyword">if</span> (tree.<span class="hljs-built_in">isValid</span>())
        apvts.<span class="hljs-built_in">replaceState</span> (tree);
}

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">JRGranularAudioProcessor::parameterChanged</span> <span class="hljs-params">(<span class="hljs-keyword">const</span> juce::String&#x26; parameterID, <span class="hljs-type">float</span> newValue)</span>
</span>{
    rnboObject.<span class="hljs-built_in">setParameterValue</span> (apvtsParamIdToRnboParamIndex[parameterID], newValue);
}

<span class="hljs-comment">//==============================================================================</span>
<span class="hljs-comment">// This creates new instances of the plugin..</span>
<span class="hljs-function">juce::AudioProcessor* JUCE_CALLTYPE <span class="hljs-title">createPluginFilter</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">JRGranularAudioProcessor</span>();
}
</code></pre>
<p>Now you have completed the minimum configuration required to link the exported code to JUCE.</p>
<h2 id="genericaudioprocessoreditor">GenericAudioProcessorEditor</h2>
<p>Using juce::GenericAudioProcessorEditor, you can quickly build the plugin without implementing the UI. Edit the following and build it.</p>
<div class="rehype-code-title">PluginProcessor.cpp</div><pre><code class="hljs language-C++"><span class="hljs-function">juce::AudioProcessorEditor* <span class="hljs-title">JRGranularAudioProcessor::createEditor</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-comment">/* return new JRGranularAudioProcessorEditor (*this, apvts, undoManager); */</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> juce::<span class="hljs-built_in">GenericAudioProcessorEditor</span> (*<span class="hljs-keyword">this</span>);
}
</code></pre>
<div class="rehype-code-title">CommandLine</div><pre><code class="hljs language-text">$ rm -rf build
$ cmake -S . -B build -DCMAKE_BUILD_TYPE=Release
$ cmake --build build --config Release
</code></pre>
<p>After the successful build, you can run the VST3/AU plugin on your DAW.</p>
<p><img src="/images/jr-granular/generic-editor.png" alt="generic-editor.png"></p>
<h2 id="customising-the-juce-ui">Customising the JUCE UI</h2>
<h3 id="preparing-for-the-customisation">Preparing for the customisation</h3>
<p>We will use the plugin editor, so disable the GenericAudioProcessorEditor:</p>
<div class="rehype-code-title">PluginProcessor.cpp</div><pre><code class="hljs language-C++"><span class="hljs-function">juce::AudioProcessorEditor* <span class="hljs-title">JRGranularAudioProcessor::createEditor</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">JRGranularAudioProcessorEditor</span> (*<span class="hljs-keyword">this</span>, apvts, undoManager);
    <span class="hljs-comment">/* return new juce::GenericAudioProcessorEditor (*this); */</span>
}
</code></pre>
<p>Create customised colours for use in the UI.</p>
<div class="rehype-code-title">CommandLine</div><pre><code class="hljs language-text">$ touch Source/MyColours.h
</code></pre>
<div class="rehype-code-title">MyColours.h</div><pre><code class="hljs language-C++"><span class="hljs-meta">#<span class="hljs-keyword">pragma</span> once</span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&#x3C;JuceHeader.h></span></span>

<span class="hljs-keyword">namespace</span> MyColours
{
    <span class="hljs-keyword">const</span> juce::Colour blue      { <span class="hljs-number">0xff6dd4ff</span> };
    <span class="hljs-keyword">const</span> juce::Colour cream     { <span class="hljs-number">0xfff6f9e4</span> };
    <span class="hljs-keyword">const</span> juce::Colour grey      { <span class="hljs-number">0xffa0a0a0</span> };
    <span class="hljs-keyword">const</span> juce::Colour midGrey   { <span class="hljs-number">0xff666666</span> };
    <span class="hljs-keyword">const</span> juce::Colour blackGrey { <span class="hljs-number">0xff353535</span> };
    <span class="hljs-keyword">const</span> juce::Colour black     { <span class="hljs-number">0xff141414</span> };
    <span class="hljs-keyword">const</span> juce::Colour red       { <span class="hljs-number">0xffff3f3f</span> };
}
</code></pre>
<p>After this, your directory structure should look something like this:
<img src="/images/jr-granular/directories.png" alt="directories.png"></p>
<p>Edit PluginEditor.h/cpp as follows. This section implements the Undo/Redo features and other small UI settings.</p>
<div class="rehype-code-title">PluginEditor.h</div><pre><code class="hljs language-C++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&#x3C;JuceHeader.h></span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"PluginProcessor.h"</span></span>

<span class="hljs-keyword">class</span> <span class="hljs-title hljs-class">JRGranularAudioProcessorEditor</span>  : <span class="hljs-keyword">public</span> juce::AudioProcessorEditor
{
<span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">JRGranularAudioProcessorEditor</span> (JRGranularAudioProcessor&#x26; p,
                                    juce::AudioProcessorValueTreeState&#x26; state,
                                    juce::UndoManager&#x26; um);

    ~<span class="hljs-built_in">JRGranularAudioProcessorEditor</span>() <span class="hljs-keyword">override</span>;

    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">paint</span> <span class="hljs-params">(juce::Graphics&#x26;)</span> <span class="hljs-keyword">override</span></span>;
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">resized</span><span class="hljs-params">()</span> <span class="hljs-keyword">override</span></span>;

    <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">keyPressed</span> <span class="hljs-params">(<span class="hljs-keyword">const</span> juce::KeyPress&#x26; key)</span> <span class="hljs-keyword">override</span></span>;

<span class="hljs-keyword">private</span>:
    JRGranularAudioProcessor&#x26; audioProcessor;
    juce::UndoManager&#x26; undoManager;

    <span class="hljs-built_in">JUCE_DECLARE_NON_COPYABLE_WITH_LEAK_DETECTOR</span> (JRGranularAudioProcessorEditor)
};
</code></pre>
<div class="rehype-code-title">PluginEditor.cpp</div><pre><code class="hljs language-c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"PluginProcessor.h"</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"PluginEditor.h"</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"MyColours.h"</span></span>

JRGranularAudioProcessorEditor::<span class="hljs-built_in">JRGranularAudioProcessorEditor</span> (JRGranularAudioProcessor&#x26; p,
                                                                juce::AudioProcessorValueTreeState&#x26; state,
                                                                juce::UndoManager&#x26; um)
    : <span class="hljs-built_in">AudioProcessorEditor</span> (&#x26;p), <span class="hljs-built_in">audioProcessor</span> (p), <span class="hljs-built_in">undoManager</span> (um)
{
    <span class="hljs-built_in">setWantsKeyboardFocus</span> (<span class="hljs-literal">true</span>);
    <span class="hljs-built_in">setSize</span> (<span class="hljs-number">440</span>, <span class="hljs-number">280</span>);
}

JRGranularAudioProcessorEditor::~<span class="hljs-built_in">JRGranularAudioProcessorEditor</span>()
{
}

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">JRGranularAudioProcessorEditor::paint</span> <span class="hljs-params">(juce::Graphics&#x26; g)</span>
</span>{
    g.<span class="hljs-built_in">fillAll</span> (MyColours::black);
}

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">JRGranularAudioProcessorEditor::resized</span><span class="hljs-params">()</span>
</span>{
}

<span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">JRGranularAudioProcessorEditor::keyPressed</span> <span class="hljs-params">(<span class="hljs-keyword">const</span> juce::KeyPress&#x26; key)</span>
</span>{
    <span class="hljs-keyword">const</span> <span class="hljs-keyword">auto</span> cmdZ = juce::KeyPress { <span class="hljs-string">'z'</span>, juce::ModifierKeys::commandModifier, <span class="hljs-number">0</span> };

    <span class="hljs-keyword">if</span> (key == cmdZ &#x26;&#x26; undoManager.<span class="hljs-built_in">canUndo</span>())
    {
        undoManager.<span class="hljs-built_in">undo</span>();
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }

    <span class="hljs-keyword">const</span> <span class="hljs-keyword">auto</span> cmdShiftZ = juce::KeyPress { <span class="hljs-string">'z'</span>, juce::ModifierKeys::commandModifier 
                                                 | juce::ModifierKeys::shiftModifier, <span class="hljs-number">0</span> };

    <span class="hljs-keyword">if</span> (key == cmdShiftZ &#x26;&#x26; undoManager.<span class="hljs-built_in">canRedo</span>())
    {
        undoManager.<span class="hljs-built_in">redo</span>();
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }

    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
}
</code></pre>
<p>After completing the above settings, build and run the standalone and you should see a black editor as shown below.</p>
<div class="rehype-code-title">CommandLine</div><pre><code class="hljs language-text">$ cmake -S . -B build -DCMAKE_BUILD_TYPE=Debug
$ cmake --build build --config Debug
$ build/JR-Granular_artefacts/Debug/Standalone/JR-Granular.app/Contents/MacOS/JR-Granular
</code></pre>
<p><img src="/images/jr-granular/setting-up.png" alt="setting-up.png"></p>
<h3 id="adding-the-custom-dial-component">Adding the custom dial component</h3>
<p>This chapter adds customised UI components.</p>
<p>This Dial has the same look and feel as Ableton's Dial and reproduces equivalent features:</p>
<ul>
<li>value changes: dragging or arrow keys</li>
<li>fine mode: shift + dragging or shift + arrow keys</li>
<li>edit mode: 0-9</li>
<li>undo: [mac] cmd + z, [win] ctrl + z</li>
<li>redo: [mac] cmd + shift + z, [win] ctrl + shift + z</li>
<li>reset: double click</li>
</ul>
<p>Create Dial.h/cpp files.</p>
<div class="rehype-code-title">CommandLine</div><pre><code class="hljs language-text">$ touch Source/Dial.{h,cpp}
</code></pre>
<p>Copy and paste the contents of Dial.h/cpp from the link below.</p>
<ul>
<li><a href="https://github.com/szkkng/jr-granular/blob/main/Source/GUI/Dial.h">Dial.h</a></li>
<li><a href="https://github.com/szkkng/jr-granular/blob/main/Source/GUI/Dial.cpp">Dial.cpp</a></li>
</ul>
<p>Add the following line to the CMakeLists.txt file.</p>
<div class="rehype-code-title">CMakeLists.txt</div><pre><code class="hljs language-diff">...
target_sources("${PROJECT_NAME}"
    PRIVATE
        RnboExport/rnbo_granular.cpp
        RnboExport/rnbo/RNBO.cpp
        Source/PluginProcessor.cpp
        Source/PluginEditor.cpp
<span class="hljs-addition">+       Source/Dial.cpp)</span>
...
</code></pre>
<p>Include the Dial.h file and declare the Dial objects.</p>
<div class="rehype-code-title">PluginEditor.h</div><pre><code class="hljs language-c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"Dial.h"</span></span>
</code></pre>
<div class="rehype-code-title">PluginEditor.h</div><pre><code class="hljs language-c++"><span class="hljs-keyword">class</span> <span class="hljs-title hljs-class">JRGranularAudioProcessorEditor</span>  : <span class="hljs-keyword">public</span> juce::AudioProcessorEditor
{
<span class="hljs-keyword">public</span>:
...
<span class="hljs-keyword">private</span>:
...
    Dial intvDial;
    Dial pitchDial;
    Dial sizeDial;
    Dial posDial;
    Dial widthDial;
    Dial mixDial;
    Dial gainDial;

    <span class="hljs-built_in">JUCE_DECLARE_NON_COPYABLE_WITH_LEAK_DETECTOR</span> (JRGranularAudioProcessorEditor)
};
</code></pre>
<p>Connect the corresponding APVTS parameters to each Dial and set them to be displayed in the plugin editor.</p>
<div class="rehype-code-title">PluginEditor.cpp</div><pre><code class="hljs language-c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"ParamIDs.h"</span></span>
</code></pre>
<div class="rehype-code-title">PluginEditor.cpp</div><pre><code class="hljs language-c++">JRGranularAudioProcessorEditor::<span class="hljs-built_in">JRGranularAudioProcessorEditor</span> (JRGranularAudioProcessor&#x26; p,
                                                                juce::AudioProcessorValueTreeState&#x26; state,
                                                                juce::UndoManager&#x26; um)
    : <span class="hljs-built_in">AudioProcessorEditor</span> (&#x26;p), <span class="hljs-built_in">audioProcessor</span> (p), <span class="hljs-built_in">undoManager</span> (um),
      <span class="hljs-built_in">intvDial</span>  (*state.<span class="hljs-built_in">getParameter</span> (ParamIDs::interval),  um),
      <span class="hljs-built_in">pitchDial</span> (*state.<span class="hljs-built_in">getParameter</span> (ParamIDs::pitch),     um),
      <span class="hljs-built_in">sizeDial</span>  (*state.<span class="hljs-built_in">getParameter</span> (ParamIDs::grainSize), um),
      <span class="hljs-built_in">posDial</span>   (*state.<span class="hljs-built_in">getParameter</span> (ParamIDs::grainPos),  um),
      <span class="hljs-built_in">widthDial</span> (*state.<span class="hljs-built_in">getParameter</span> (ParamIDs::width),     um),
      <span class="hljs-built_in">mixDial</span>   (*state.<span class="hljs-built_in">getParameter</span> (ParamIDs::mix),       um),
      <span class="hljs-built_in">gainDial</span>  (*state.<span class="hljs-built_in">getParameter</span> (ParamIDs::gain),      um)

{
    <span class="hljs-built_in">setWantsKeyboardFocus</span> (<span class="hljs-literal">true</span>);
    <span class="hljs-built_in">setSize</span> (<span class="hljs-number">440</span>, <span class="hljs-number">280</span>);

    intvDial.<span class="hljs-built_in">setLabelText</span> (<span class="hljs-string">"intv"</span>);
    mixDial.<span class="hljs-built_in">setLabelText</span>  (<span class="hljs-string">"mix"</span>);
    posDial.<span class="hljs-built_in">setLabelText</span>  (<span class="hljs-string">"pos"</span>);
    sizeDial.<span class="hljs-built_in">setLabelText</span> (<span class="hljs-string">"size"</span>);
    gainDial.<span class="hljs-built_in">setLabelText</span> (<span class="hljs-string">"vol"</span>);

    <span class="hljs-comment">// Set interval of values changed by arrow keys or shift + arrow keys.</span>
    intvDial.<span class="hljs-built_in">setInterval</span> (<span class="hljs-number">5.0f</span>);
    intvDial.<span class="hljs-built_in">setFineInterval</span> (<span class="hljs-number">1.0f</span>);
    sizeDial.<span class="hljs-built_in">setInterval</span> (<span class="hljs-number">5.0f</span>);
    sizeDial.<span class="hljs-built_in">setFineInterval</span> (<span class="hljs-number">1.0f</span>);
    posDial.<span class="hljs-built_in">setInterval</span> (<span class="hljs-number">5.0f</span>);
    posDial.<span class="hljs-built_in">setFineInterval</span> (<span class="hljs-number">1.0f</span>);
    pitchDial.<span class="hljs-built_in">setInterval</span> (<span class="hljs-number">1.0f</span>);
    pitchDial.<span class="hljs-built_in">setFineInterval</span> (<span class="hljs-number">0.1f</span>);
    gainDial.<span class="hljs-built_in">setInterval</span> (<span class="hljs-number">1.0f</span>);
    gainDial.<span class="hljs-built_in">setFineInterval</span> (<span class="hljs-number">0.1f</span>);

    <span class="hljs-built_in">addAndMakeVisible</span> (sizeDial);
    <span class="hljs-built_in">addAndMakeVisible</span> (posDial);
    <span class="hljs-built_in">addAndMakeVisible</span> (intvDial);
    <span class="hljs-built_in">addAndMakeVisible</span> (widthDial);
    <span class="hljs-built_in">addAndMakeVisible</span> (pitchDial);
    <span class="hljs-built_in">addAndMakeVisible</span> (mixDial);
    <span class="hljs-built_in">addAndMakeVisible</span> (gainDial);
}
</code></pre>
<div class="rehype-code-title">PluginEditor.cpp</div><pre><code class="hljs language-c++"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">JRGranularAudioProcessorEditor::resized</span><span class="hljs-params">()</span>
</span>{
    intvDial.<span class="hljs-built_in">setBounds</span>  (<span class="hljs-number">30</span>,  <span class="hljs-number">30</span>,  <span class="hljs-number">80</span>, <span class="hljs-number">95</span>);
    pitchDial.<span class="hljs-built_in">setBounds</span> (<span class="hljs-number">130</span>, <span class="hljs-number">30</span>,  <span class="hljs-number">80</span>, <span class="hljs-number">95</span>);
    sizeDial.<span class="hljs-built_in">setBounds</span>  (<span class="hljs-number">230</span>, <span class="hljs-number">30</span>,  <span class="hljs-number">80</span>, <span class="hljs-number">95</span>);
    posDial.<span class="hljs-built_in">setBounds</span>   (<span class="hljs-number">330</span>, <span class="hljs-number">30</span>,  <span class="hljs-number">80</span>, <span class="hljs-number">95</span>);
    widthDial.<span class="hljs-built_in">setBounds</span> (<span class="hljs-number">80</span>,  <span class="hljs-number">155</span>, <span class="hljs-number">80</span>, <span class="hljs-number">95</span>);
    mixDial.<span class="hljs-built_in">setBounds</span>   (<span class="hljs-number">180</span>, <span class="hljs-number">155</span>, <span class="hljs-number">80</span>, <span class="hljs-number">95</span>);
    gainDial.<span class="hljs-built_in">setBounds</span>  (<span class="hljs-number">280</span>, <span class="hljs-number">155</span>, <span class="hljs-number">80</span>, <span class="hljs-number">95</span>);
}
</code></pre>
<h3 id="embedding-a-custom-font">Embedding a custom font</h3>
<p>The font embedded in JR-Granular is FuturaMedium.ttf font, which is automatically <a href="https://support.apple.com/en-us/HT212587">installed</a> in macOS.</p>
<p>Launch Font Book application and look for Futura Medium Font.</p>
<p><img src="/images/jr-granular/futura-medium.png" alt="futura-medium.png"></p>
<p>Use Finder application to show where this font is on your system. You can find the .ttc file in this way:</p>
<p><img src="/images/jr-granular/find-ttc.png" alt="find-ttc.png"></p>
<p>A .ttc file is like a collection of .ttf files, and in the case of Futura.ttc, it contains the following .ttf files:</p>
<ul>
<li>Futura-Medium.ttf</li>
<li>Futura-MediumItalic.ttf</li>
<li>Futura-Bold.ttf</li>
<li>Futura-CondensedMedium.ttf</li>
<li>Futura-CondensedExtraBold.ttf</li>
</ul>
<p>Since we only want to use Futura-Medium.ttf, use the tool below to break down the .ttc file into multiple .ttf files and download only the Futura-Medium.ttf.</p>
<ul>
<li><a href="https://transfonter.org/ttc-unpack">Transfonter</a></li>
</ul>
<p><img src="/images/jr-granular/transfonter.png" alt="transfonter.png"></p>
<p>Create Resources directory, rename the downloaded Futura-Medium-01.ttf to FuturaMedium.ttf and place it under the directory.</p>
<div class="rehype-code-title">CommandLine</div><pre><code class="hljs language-text">$ mkdir Resources
$ mv ~/Downloads/Futura-Medium-01.ttf Resources/FuturaMedium.ttf
</code></pre>
<p>After these settings, your directory structure should look something like this:</p>
<p><img src="/images/jr-granular/dir-structure.png" alt="dir-structure.png"></p>
<p>Go to the CMakeLists.txt, add juce_add_binary_data function and edit target_link_libraries function:</p>
<div class="rehype-code-title">CMakeLists.txt</div><pre><code class="hljs language-diff"><span class="hljs-addition">+ juce_add_binary_data(BinaryData</span>
<span class="hljs-addition">+     SOURCES</span>
<span class="hljs-addition">+         Resources/FuturaMedium.ttf)</span>

target_link_libraries("${PROJECT_NAME}"
    PRIVATE
<span class="hljs-addition">+       BinaryData</span>
        juce::juce_audio_utils
        juce::juce_recommended_config_flags
        juce::juce_recommended_lto_flags
        juce::juce_recommended_warning_flags)
</code></pre>
<p>Finally, add the following code in the constructor of the plugin editor.</p>
<div class="rehype-code-title">pluginEditor.cpp</div><pre><code class="hljs language-c++">JRGranularAudioProcessorEditor::<span class="hljs-built_in">JRGranularAudioProcessorEditor</span> (JRGranularAudioProcessor&#x26; p,
                                                                juce::AudioProcessorValueTreeState&#x26; state,
                                                                juce::UndoManager&#x26; um)
...
{
    <span class="hljs-keyword">auto</span> futuraMedium = juce::Typeface::<span class="hljs-built_in">createSystemTypefaceFor</span> (BinaryData::FuturaMedium_ttf, 
                                                                 BinaryData::FuturaMedium_ttfSize);
    juce::LookAndFeel::<span class="hljs-built_in">getDefaultLookAndFeel</span>().<span class="hljs-built_in">setDefaultSansSerifTypeface</span> (futuraMedium);
...
}
</code></pre>
<h3 id="building">Building</h3>
<p>All done! Build and run it on your DAW.</p>
<div class="rehype-code-title">CommandLine</div><pre><code class="hljs language-text">$ rm -rf build
$ cmake -S . -B build -DCMAKE_BUILD_TYPE=Release
$ cmake --build build --config Release
</code></pre>
<p><img src="/images/jr-granular/finish.png" alt="finish.png"></p>
<h2 id="closing">Closing</h2>
<p>In this tutorial I have explained the following:</p>
<ul>
<li>how to do the RNBO C++ export</li>
<li>how to include the exported code into a JUCE project</li>
<li>how to connect the exported code and JUCE using <a href="https://docs.juce.com/master/classAudioProcessorValueTreeState.html">APVTS</a></li>
</ul>
<p>If there are any typos or better ways of the implementation, please do comment. Happy Coding!</p>
<h2 id="references">References</h2>
<ul>
<li><a href="https://rnbo.cycling74.com/learn/using-the-audio-plugin-template">Using the Audio Plugin/Application Template</a></li>
<li><a href="https://rnbo.cycling74.com/learn/programming-a-custom-ui-with-juce">Programming a Custom UI with JUCE</a></li>
<li><a href="https://rnbo.cycling74.com/cpp">RNBO C++ API Reference</a></li>
<li><a href="https://github.com/Cycling74/gen-plugin-export">Cycling74/gen-plugin-export</a></li>
<li><a href="https://docs.juce.com/master/index.html">JUCE: Class Index</a></li>
</ul></div><div class="mt-10"><h2 class="mb-2">Comments</h2><section style="width:100%"></section></div></article><div class="hidden break-words lg:block lg:w-1/4 lg:ml-10 mt-16"><div class="sticky top-32 overflow-auto h-600"><div class="toc"></div></div></div></div></main><footer class="h-20"><div class="mt-10 pt-4 text-center"><a class="text-cream text-lg" href="/">Home</a></div></footer><div class="container px-6 lg:px-12 mx-auto flex items-center"><div class="flex mx-auto"><p class="text-sm text-grey">theme forked from<a class="text-grey hover:text-matteBlack" href="https://github.com/szkkng/kengo-dev"><span></span>szkkng/kengo-dev</a></p></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"postData":{"id":"test","contentHtml":"\u003ch2 id=\"introduction\"\u003eIntroduction\u003c/h2\u003e\n\u003cp\u003e\u003cimg src=\"/images/jr-granular/jr-granular.png\" alt=\"jr-granular.png\"\u003e\u003c/p\u003e\n\u003cp\u003eIn this tutorial I will show you how to make \u003ca href=\"https://github.com/szkkng/jr-granular\"\u003eJR-Granular\u003c/a\u003e, a real-time granular fx plugin, with\r\nRNBO C++ export and JUCE. In particular, I will focus on the following:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003ehow to do the RNBO C++ export\u003c/li\u003e\n\u003cli\u003ehow to connect the exported code and JUCE using \u003ca href=\"https://docs.juce.com/master/classAudioProcessorValueTreeState.html\"\u003eAPVTS\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003ehow to make custom UIs with JUCE\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eLet's get started.\u003c/p\u003e\n\u003ch3 id=\"prerequisites\"\u003ePrerequisites\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eInstall Xcode Command Line Tools by running \"xcode-select --install\".\u003c/li\u003e\n\u003cli\u003eDownload and install \u003ca href=\"https://cmake.org/download/\"\u003eCMake\u003c/a\u003e by running \"brew install cmake\".\u003c/li\u003e\n\u003cli\u003eGet Projucer by downloading \u003ca href=\"https://juce.com/get-juce/download\"\u003eJUCE\u003c/a\u003e.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"making-rnbo-granularmaxpat\"\u003eMaking rnbo-granular.maxpat\u003c/h2\u003e\n\u003cp\u003eIn this chapter we will quickly implement a real-time granular fx using the gen~ codebox.\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eCreate a rnbo~ object.\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e\u003cimg src=\"/images/jr-granular/create-rnbo-object.png\" alt=\"create-rnbo-object.png\"\u003e\u003c/p\u003e\n\u003col start=\"2\"\u003e\n\u003cli\u003eCreate a gen~ object in the rnbo patcher\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e\u003cimg src=\"/images/jr-granular/create-gen-object.png\" alt=\"create-gen-object.png\"\u003e\u003c/p\u003e\n\u003col start=\"3\"\u003e\n\u003cli\u003eCreate a codebox object in the gen patcher\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e\u003cimg src=\"/images/jr-granular/create-codebox.png\" alt=\"create-codebox.png\"\u003e\u003c/p\u003e\n\u003col start=\"4\"\u003e\n\u003cli\u003eCopy the following gen code and paste it into the codebox.\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e\u003cimg src=\"/images/jr-granular/codebox.png\" alt=\"codebox.png\"\u003e\u003c/p\u003e\n\u003cdiv class=\"rehype-code-title\"\u003ecodebox\u003c/div\u003e\u003cpre\u003e\u003ccode class=\"hljs language-c++\"\u003e\u003cspan class=\"hljs-function\"\u003eParam \u003cspan class=\"hljs-title\"\u003einterval\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(\u003cspan class=\"hljs-number\"\u003e100\u003c/span\u003e)\u003c/span\u003e\u003c/span\u003e;\r\n\u003cspan class=\"hljs-function\"\u003eParam \u003cspan class=\"hljs-title\"\u003egrainSize\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(\u003cspan class=\"hljs-number\"\u003e100\u003c/span\u003e)\u003c/span\u003e\u003c/span\u003e;\r\n\u003cspan class=\"hljs-function\"\u003eParam \u003cspan class=\"hljs-title\"\u003egrainPos\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(\u003cspan class=\"hljs-number\"\u003e100\u003c/span\u003e)\u003c/span\u003e\u003c/span\u003e;\r\n\u003cspan class=\"hljs-function\"\u003eParam \u003cspan class=\"hljs-title\"\u003ewidth\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(\u003cspan class=\"hljs-number\"\u003e0.5\u003c/span\u003e)\u003c/span\u003e\u003c/span\u003e;\r\n\u003cspan class=\"hljs-function\"\u003eParam \u003cspan class=\"hljs-title\"\u003epitch\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e)\u003c/span\u003e\u003c/span\u003e;\r\n\u003cspan class=\"hljs-function\"\u003eParam \u003cspan class=\"hljs-title\"\u003emix\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(\u003cspan class=\"hljs-number\"\u003e0.5\u003c/span\u003e)\u003c/span\u003e\u003c/span\u003e;\r\n\u003cspan class=\"hljs-function\"\u003eParam \u003cspan class=\"hljs-title\"\u003egain\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e)\u003c/span\u003e\u003c/span\u003e;\r\n\r\n\u003cspan class=\"hljs-function\"\u003eDelay \u003cspan class=\"hljs-title\"\u003edel_inL\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(samplerate * \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e)\u003c/span\u003e\u003c/span\u003e;\r\n\u003cspan class=\"hljs-function\"\u003eDelay \u003cspan class=\"hljs-title\"\u003edel_inR\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(samplerate * \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e)\u003c/span\u003e\u003c/span\u003e;\r\n\r\n\u003cspan class=\"hljs-function\"\u003eData \u003cspan class=\"hljs-title\"\u003edata_param\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(\u003cspan class=\"hljs-number\"\u003e6\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e100\u003c/span\u003e)\u003c/span\u003e\u003c/span\u003e;\r\n\r\n\u003cspan class=\"hljs-function\"\u003eHistory \u003cspan class=\"hljs-title\"\u003ehis_index\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e)\u003c/span\u003e\u003c/span\u003e;\r\n\u003cspan class=\"hljs-function\"\u003eHistory \u003cspan class=\"hljs-title\"\u003ehis_mix\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e)\u003c/span\u003e, \u003cspan class=\"hljs-title\"\u003ehis_gain\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e)\u003c/span\u003e\u003c/span\u003e;\r\n\r\nhis_mix = (mix - his_mix) * \u003cspan class=\"hljs-number\"\u003e0.001\u003c/span\u003e + his_mix;\r\nhis_gain = (gain - his_gain) * \u003cspan class=\"hljs-number\"\u003e0.001\u003c/span\u003e + his_gain;\r\n\r\nmaxVoice = \u003cspan class=\"hljs-number\"\u003e100\u003c/span\u003e;\r\n\r\ndel_inL.\u003cspan class=\"hljs-built_in\"\u003ewrite\u003c/span\u003e(in1);\r\ndel_inR.\u003cspan class=\"hljs-built_in\"\u003ewrite\u003c/span\u003e(in2);\r\n\r\nmCout = \u003cspan class=\"hljs-built_in\"\u003ecounter\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, \u003cspan class=\"hljs-built_in\"\u003emstosamps\u003c/span\u003e(interval));\r\n\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (mCout == \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e) {\r\n\t\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (\u003cspan class=\"hljs-built_in\"\u003epeek\u003c/span\u003e(data_param, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, his_index) == \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e) {\r\n\t\t\u003cspan class=\"hljs-built_in\"\u003epoke\u003c/span\u003e(data_param, \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, his_index);\r\n\t\t\u003cspan class=\"hljs-built_in\"\u003epoke\u003c/span\u003e(data_param, \u003cspan class=\"hljs-built_in\"\u003emstosamps\u003c/span\u003e(grainSize), \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, his_index);\r\n\t\tsizeScaled = \u003cspan class=\"hljs-built_in\"\u003emstosamps\u003c/span\u003e(grainSize);\r\n\t\twidthRand = \u003cspan class=\"hljs-built_in\"\u003enoise\u003c/span\u003e() * \u003cspan class=\"hljs-number\"\u003e0.5\u003c/span\u003e * width;\r\n\t\t\u003cspan class=\"hljs-built_in\"\u003epoke\u003c/span\u003e(data_param, \u003cspan class=\"hljs-number\"\u003e0.5\u003c/span\u003e + widthRand, \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e, his_index);\r\n\t\t\u003cspan class=\"hljs-built_in\"\u003epoke\u003c/span\u003e(data_param, \u003cspan class=\"hljs-number\"\u003e0.5\u003c/span\u003e - widthRand, \u003cspan class=\"hljs-number\"\u003e4\u003c/span\u003e, his_index);\r\n\t\tpitchScaled = \u003cspan class=\"hljs-built_in\"\u003epow\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e, pitch / \u003cspan class=\"hljs-number\"\u003e12\u003c/span\u003e) - \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e;\r\n\t\t\u003cspan class=\"hljs-built_in\"\u003epoke\u003c/span\u003e(data_param, pitchScaled, \u003cspan class=\"hljs-number\"\u003e5\u003c/span\u003e, his_index);\r\n\t\this_index = \u003cspan class=\"hljs-built_in\"\u003ewrap\u003c/span\u003e(his_index + \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, maxVoice);\r\n\t\tposScaled = \u003cspan class=\"hljs-built_in\"\u003emstosamps\u003c/span\u003e(grainPos) * \u003cspan class=\"hljs-built_in\"\u003eabs\u003c/span\u003e(\u003cspan class=\"hljs-built_in\"\u003enoise\u003c/span\u003e());\r\n\t\t\u003cspan class=\"hljs-built_in\"\u003epoke\u003c/span\u003e(data_param, posScaled + \u003cspan class=\"hljs-built_in\"\u003emax\u003c/span\u003e(sizeScaled*pitchScaled, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e), \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e, his_index);\r\n\t}\r\n}\r\n\r\noutL = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e;\r\noutR = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e;\r\ntotalWin = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e;\r\n\u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e (i = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e; i \u0026#x3C; maxVoice; i += \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e) {\r\n\tpCout = \u003cspan class=\"hljs-built_in\"\u003epeek\u003c/span\u003e(data_param, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, i);\r\n\t\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (pCout != \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e) {\r\n\t\ts = \u003cspan class=\"hljs-built_in\"\u003epeek\u003c/span\u003e(data_param, \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, i);\r\n\t\t\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (pCout \u0026#x3C; s) {\r\n\t\t\tpCoutScaled = pCout / s;\r\n\t\t\twin = \u003cspan class=\"hljs-number\"\u003e0.5\u003c/span\u003e * (\u003cspan class=\"hljs-built_in\"\u003esin\u003c/span\u003e (\u003cspan class=\"hljs-number\"\u003e1.5\u003c/span\u003e * PI + pCoutScaled * TWOPI) + \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e);\r\n\t\t\toutputL = del_inL.\u003cspan class=\"hljs-built_in\"\u003eread\u003c/span\u003e(\u003cspan class=\"hljs-built_in\"\u003epeek\u003c/span\u003e(data_param, \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e, i) - pCout * \u003cspan class=\"hljs-built_in\"\u003epeek\u003c/span\u003e(data_param, \u003cspan class=\"hljs-number\"\u003e5\u003c/span\u003e, i)) * win;\r\n\t\t\toutputR = del_inR.\u003cspan class=\"hljs-built_in\"\u003eread\u003c/span\u003e(\u003cspan class=\"hljs-built_in\"\u003epeek\u003c/span\u003e(data_param, \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e, i) - pCout * \u003cspan class=\"hljs-built_in\"\u003epeek\u003c/span\u003e(data_param, \u003cspan class=\"hljs-number\"\u003e5\u003c/span\u003e, i)) * win;\r\n\t\t\toutL += outputL * \u003cspan class=\"hljs-built_in\"\u003epeek\u003c/span\u003e(data_param, \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e, i);\r\n\t\t\toutR += outputR * \u003cspan class=\"hljs-built_in\"\u003epeek\u003c/span\u003e(data_param, \u003cspan class=\"hljs-number\"\u003e4\u003c/span\u003e, i);\r\n\t\t\t\u003cspan class=\"hljs-built_in\"\u003epoke\u003c/span\u003e(data_param, pCout + \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, i);\r\n\t\t\ttotalWin += win;\r\n\t\t} \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\r\n\t\t\t\u003cspan class=\"hljs-built_in\"\u003epoke\u003c/span\u003e(data_param, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, i);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nnormalise = \u003cspan class=\"hljs-built_in\"\u003epow\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e / \u003cspan class=\"hljs-built_in\"\u003emax\u003c/span\u003e(totalWin, \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e), \u003cspan class=\"hljs-number\"\u003e0.3\u003c/span\u003e) * his_gain;\r\nout1 = \u003cspan class=\"hljs-built_in\"\u003emix\u003c/span\u003e(in1, outL * normalise, his_mix);\r\nout2 = \u003cspan class=\"hljs-built_in\"\u003emix\u003c/span\u003e(in2, outR * normalise, his_mix);\n\u003c/code\u003e\u003c/pre\u003e\n\u003col start=\"5\"\u003e\n\u003cli\u003eFinally, create param and setparam objects as shown below:\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e\u003cimg src=\"/images/jr-granular/gen-and-others.png\" alt=\"gen-and-others.png\"\u003e\u003c/p\u003e\n\u003ch2 id=\"setting-up-a-juce-project\"\u003eSetting up a JUCE project\u003c/h2\u003e\n\u003cp\u003eFirst, open Projucer and create a new project named JRGranular to generate the template files PluginProcessor.h/cpp and PluginEditor.h/cpp.\r\nWe will build our projects using CMake, so we will not use Projucer anymore.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/jr-granular/new-project.png\" alt=\"new-project.png\"\u003e\u003c/p\u003e\n\u003cp\u003eGo to the project directory and delete unnecessary files.\u003c/p\u003e\n\u003cdiv class=\"rehype-code-title\"\u003eCommandLine\u003c/div\u003e\u003cpre\u003e\u003ccode class=\"hljs language-text\"\u003e$ cd ~/Desktop/JRGranular\r\n$ rm -rf Builds JuceLibraryCode JRGranular.jucer\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eAdd JUCE v7.0.2 to the project with the following command:\u003c/p\u003e\n\u003cdiv class=\"rehype-code-title\"\u003eCommandLine\u003c/div\u003e\u003cpre\u003e\u003ccode class=\"hljs language-text\"\u003e$ git init\r\n$ git submodule add https://github.com/juce-framework/JUCE.git External/JUCE\r\n$ cd External/JUCE\r\n$ git checkout 7.0.2\r\n$ cd -\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eCreate RnboExport directory for RNBO C++ export destination.\u003c/p\u003e\n\u003cdiv class=\"rehype-code-title\"\u003eCommandLine\u003c/div\u003e\u003cpre\u003e\u003ccode class=\"hljs language-text\"\u003e$ mkdir RnboExport\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eCreate a CMakeLists.txt file, copy and paste the following code into it\u003c/p\u003e\n\u003cdiv class=\"rehype-code-title\"\u003eCommandLine\u003c/div\u003e\u003cpre\u003e\u003ccode class=\"hljs language-text\"\u003e$ touch CMakeLists.txt\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"rehype-code-title\"\u003eCMakeLists.txt\u003c/div\u003e\u003cpre\u003e\u003ccode class=\"hljs language-text\"\u003ecmake_minimum_required(VERSION 3.21)\r\n\r\nset(PROJECT_NAME \"JR-Granular\")\r\nset(CMAKE_OSX_ARCHITECTURES \"arm64;x86_64\" CACHE STRING \"Build architectures for macOS\")\r\nset(CMAKE_OSX_DEPLOYMENT_TARGET \"10.11\" CACHE STRING \"Minimum macOS version required\")\r\n\r\nproject(\"${PROJECT_NAME}\" VERSION 1.0.0)\r\n\r\nset(formats \"VST3\" \"Standalone\")\r\n\r\nif(APPLE)\r\n    list(APPEND formats \"AU\")\r\nendif()\r\n\r\nadd_subdirectory(External/JUCE)\r\n\r\njuce_add_plugin(\"${PROJECT_NAME}\"\r\n    VERSION \"1.0.0\"\r\n    COMPANY_NAME \"JR-Granular\"\r\n    PLUGIN_MANUFACTURER_CODE \"Jrgn\"\r\n    PLUGIN_CODE \"R001\"\r\n    FORMATS ${formats}\r\n    COPY_PLUGIN_AFTER_BUILD TRUE\r\n    IS_SYNTH FALSE     \r\n    NEEDS_MIDI_INPUT FALSE\r\n    NEEDS_MIDI_OUTPUT FALSE\r\n    IS_MIDI_EFFECT FALSE\r\n    PRODUCT_NAME \"${PROJECT_NAME}\")\r\n\r\njuce_generate_juce_header(\"${PROJECT_NAME}\")\r\n\r\ninclude_directories(\r\n    \"${CMAKE_CURRENT_SOURCE_DIR}/RnboExport/rnbo\"\r\n    \"${CMAKE_CURRENT_SOURCE_DIR}/RnboExport/rnbo/common\")\r\n\r\ntarget_sources(\"${PROJECT_NAME}\"\r\n    PRIVATE\r\n        RnboExport/rnbo_granular.cpp\r\n        RnboExport/rnbo/RNBO.cpp\r\n        Source/PluginProcessor.cpp\r\n        Source/PluginEditor.cpp)\r\n\r\ntarget_compile_features(\"${PROJECT_NAME}\" PUBLIC cxx_std_20)\r\n\r\ntarget_compile_definitions(\"${PROJECT_NAME}\"\r\n    PUBLIC\r\n        JUCE_WEB_BROWSER=0\r\n        JUCE_USE_CURL=0\r\n        JUCE_VST3_CAN_REPLACE_VST2=0)\r\n\r\ntarget_link_libraries(\"${PROJECT_NAME}\"\r\n    PRIVATE\r\n        juce::juce_audio_utils\r\n        juce::juce_recommended_config_flags\r\n        juce::juce_recommended_lto_flags\r\n        juce::juce_recommended_warning_flags)\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eAfter these settings, your directory structure should look something like this:\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/jr-granular/directory-structure.png\" alt=\"directories.png\"\u003e\u003c/p\u003e\n\u003ch2 id=\"rnbo-c-export\"\u003eRNBO C++ Export\u003c/h2\u003e\n\u003cp\u003eClick on the export sidebar button located in the right toolbar, and select the C++ Source Code Export.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/jr-granular/export-sidebar.png\" alt=\"export-sidebar.png\"\u003e\u003c/p\u003e\n\u003cp\u003eClick on the choose button to specify the RnboExport directory as the output directory.\r\n\u003cimg src=\"/images/jr-granular/output-directory.png\" alt=\"output-directory.png\"\u003e\u003c/p\u003e\n\u003cp\u003eChange the Export Name and the Classname as follows:\r\n\u003cimg src=\"/images/jr-granular/names.png\" alt=\"names.png\"\u003e\u003c/p\u003e\n\u003cp\u003eClick on the Export to Selected Target button at the bottom right of the window. If there are no error messages in the Export Log, you have succeeded.\r\n\u003cimg src=\"/images/jr-granular/export.png\" alt=\"export.png\"\u003e\u003c/p\u003e\n\u003cp\u003eReturn to the console and check that the project can be built successfully.\u003c/p\u003e\n\u003cdiv class=\"rehype-code-title\"\u003eCommandLine\u003c/div\u003e\u003cpre\u003e\u003ccode class=\"hljs language-text\"\u003e$ cmake -S . -B build -DCMAKE_BUILD_TYPE=Debug\r\n$ cmake --build build --config Debug\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eRun the standalone with the following command. You should see \"Hello, World\".\u003c/p\u003e\n\u003cdiv class=\"rehype-code-title\"\u003eCommandLine\u003c/div\u003e\u003cpre\u003e\u003ccode class=\"hljs language-text\"\u003e$ build/JR-Granular_artefacts/Debug/Standalone/JR-Granular.app/Contents/MacOS/JR-Granular\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cimg src=\"/images/jr-granular/hello-world.png\" alt=\"hello-world.png\"\u003e\u003c/p\u003e\n\u003ch2 id=\"connecting-the-exported-code-with-juce\"\u003eConnecting the exported code with JUCE\u003c/h2\u003e\n\u003cp\u003eThis chapter explains how to link the exported c++ code with JUCE. My approach is to use \u003ca href=\"https://docs.juce.com/master/classAudioProcessorValueTreeState.html\"\u003ejuce::AudioProcessorValueTreeState\u003c/a\u003e.\u003c/p\u003e\n\u003ch3 id=\"paramidsh\"\u003eParamIDs.h\u003c/h3\u003e\n\u003cp\u003eFirst, create the string IDs in ParamIDs.h, which are needed when creating JUCE apvts parameters and when linking the UI and DSP. I do this to prevent typing errors. The value of each variable must correspond to the value of \"paramId\" listed in the RnboExport/description.json.\u003c/p\u003e\n\u003cdiv class=\"rehype-code-title\"\u003eCommandLine\u003c/div\u003e\u003cpre\u003e\u003ccode class=\"hljs language-text\"\u003e$ touch Source/ParamIDs.h\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"rehype-code-title\"\u003eParamIDs.h\u003c/div\u003e\u003cpre\u003e\u003ccode class=\"hljs language-C++\"\u003e\u003cspan class=\"hljs-meta\"\u003e#\u003cspan class=\"hljs-keyword\"\u003epragma\u003c/span\u003e once\u003c/span\u003e\r\n\r\n\u003cspan class=\"hljs-keyword\"\u003enamespace\u003c/span\u003e ParamIDs\r\n{\r\n\r\n    \u003cspan class=\"hljs-comment\"\u003e// Be the same value as the \"paramId\" listed in the rnbo description.json.\u003c/span\u003e\r\n    \u003cspan class=\"hljs-keyword\"\u003einline\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003econstexpr\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eauto\u003c/span\u003e mix       { \u003cspan class=\"hljs-string\"\u003e\"mix\"\u003c/span\u003e };\r\n    \u003cspan class=\"hljs-keyword\"\u003einline\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003econstexpr\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eauto\u003c/span\u003e gain      { \u003cspan class=\"hljs-string\"\u003e\"gain\"\u003c/span\u003e };\r\n    \u003cspan class=\"hljs-keyword\"\u003einline\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003econstexpr\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eauto\u003c/span\u003e grainPos  { \u003cspan class=\"hljs-string\"\u003e\"grainPos\"\u003c/span\u003e };\r\n    \u003cspan class=\"hljs-keyword\"\u003einline\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003econstexpr\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eauto\u003c/span\u003e grainSize { \u003cspan class=\"hljs-string\"\u003e\"grainSize\"\u003c/span\u003e };\r\n    \u003cspan class=\"hljs-keyword\"\u003einline\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003econstexpr\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eauto\u003c/span\u003e interval  { \u003cspan class=\"hljs-string\"\u003e\"interval\"\u003c/span\u003e };\r\n    \u003cspan class=\"hljs-keyword\"\u003einline\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003econstexpr\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eauto\u003c/span\u003e pitch     { \u003cspan class=\"hljs-string\"\u003e\"pitch\"\u003c/span\u003e };\r\n    \u003cspan class=\"hljs-keyword\"\u003einline\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003econstexpr\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eauto\u003c/span\u003e width     { \u003cspan class=\"hljs-string\"\u003e\"width\"\u003c/span\u003e };\r\n\r\n} \u003cspan class=\"hljs-comment\"\u003e// namespace paramIDs\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"pluginprocessorhcpp\"\u003ePluginProcessor.h/cpp\u003c/h3\u003e\n\u003cp\u003ePluginProcessor.h/cpp is as follows.\u003c/p\u003e\n\u003cdiv class=\"rehype-code-title\"\u003ePluginProcessor.h\u003c/div\u003e\u003cpre\u003e\u003ccode class=\"hljs language-C++\"\u003e\u003cspan class=\"hljs-meta\"\u003e#\u003cspan class=\"hljs-keyword\"\u003epragma\u003c/span\u003e once\u003c/span\u003e\r\n\r\n\u003cspan class=\"hljs-meta\"\u003e#\u003cspan class=\"hljs-keyword\"\u003einclude\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026#x3C;JuceHeader.h\u003e\u003c/span\u003e\u003c/span\u003e\r\n\u003cspan class=\"hljs-meta\"\u003e#\u003cspan class=\"hljs-keyword\"\u003einclude\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"RNBO.h\"\u003c/span\u003e\u003c/span\u003e\r\n\r\n\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title hljs-class\"\u003eJRGranularAudioProcessor\u003c/span\u003e  : \u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e juce::AudioProcessor,\r\n                                  \u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e juce::AudioProcessorValueTreeState::Listener\r\n{\r\n\u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e:\r\n    \u003cspan class=\"hljs-comment\"\u003e//==============================================================================\u003c/span\u003e\r\n    \u003cspan class=\"hljs-built_in\"\u003eJRGranularAudioProcessor\u003c/span\u003e();\r\n    ~\u003cspan class=\"hljs-built_in\"\u003eJRGranularAudioProcessor\u003c/span\u003e() \u003cspan class=\"hljs-keyword\"\u003eoverride\u003c/span\u003e;\r\n\r\n    \u003cspan class=\"hljs-comment\"\u003e//==============================================================================\u003c/span\u003e\r\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-type\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eprepareToPlay\u003c/span\u003e \u003cspan class=\"hljs-params\"\u003e(\u003cspan class=\"hljs-type\"\u003edouble\u003c/span\u003e sampleRate, \u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e samplesPerBlock)\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eoverride\u003c/span\u003e\u003c/span\u003e;\r\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-type\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003ereleaseResources\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eoverride\u003c/span\u003e\u003c/span\u003e;\r\n\r\n   \u003cspan class=\"hljs-meta\"\u003e#\u003cspan class=\"hljs-keyword\"\u003eifndef\u003c/span\u003e JucePlugin_PreferredChannelConfigurations\u003c/span\u003e\r\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-type\"\u003ebool\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eisBusesLayoutSupported\u003c/span\u003e \u003cspan class=\"hljs-params\"\u003e(\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e BusesLayout\u0026#x26; layouts)\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eoverride\u003c/span\u003e\u003c/span\u003e;\r\n   \u003cspan class=\"hljs-meta\"\u003e#\u003cspan class=\"hljs-keyword\"\u003eendif\u003c/span\u003e\u003c/span\u003e\r\n\r\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-type\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eprocessBlock\u003c/span\u003e \u003cspan class=\"hljs-params\"\u003e(juce::AudioBuffer\u0026#x3C;\u003cspan class=\"hljs-type\"\u003efloat\u003c/span\u003e\u003e\u0026#x26;, juce::MidiBuffer\u0026#x26;)\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eoverride\u003c/span\u003e\u003c/span\u003e;\r\n\r\n    \u003cspan class=\"hljs-comment\"\u003e//==============================================================================\u003c/span\u003e\r\n    \u003cspan class=\"hljs-function\"\u003ejuce::AudioProcessorEditor* \u003cspan class=\"hljs-title\"\u003ecreateEditor\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eoverride\u003c/span\u003e\u003c/span\u003e;\r\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-type\"\u003ebool\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003ehasEditor\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eoverride\u003c/span\u003e\u003c/span\u003e;\r\n\r\n    \u003cspan class=\"hljs-comment\"\u003e//==============================================================================\u003c/span\u003e\r\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e juce::String \u003cspan class=\"hljs-title\"\u003egetName\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eoverride\u003c/span\u003e\u003c/span\u003e;\r\n\r\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-type\"\u003ebool\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eacceptsMidi\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eoverride\u003c/span\u003e\u003c/span\u003e;\r\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-type\"\u003ebool\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eproducesMidi\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eoverride\u003c/span\u003e\u003c/span\u003e;\r\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-type\"\u003ebool\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eisMidiEffect\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eoverride\u003c/span\u003e\u003c/span\u003e;\r\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-type\"\u003edouble\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003egetTailLengthSeconds\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eoverride\u003c/span\u003e\u003c/span\u003e;\r\n\r\n    \u003cspan class=\"hljs-comment\"\u003e//==============================================================================\u003c/span\u003e\r\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003egetNumPrograms\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eoverride\u003c/span\u003e\u003c/span\u003e;\r\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003egetCurrentProgram\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eoverride\u003c/span\u003e\u003c/span\u003e;\r\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-type\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003esetCurrentProgram\u003c/span\u003e \u003cspan class=\"hljs-params\"\u003e(\u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e index)\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eoverride\u003c/span\u003e\u003c/span\u003e;\r\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e juce::String \u003cspan class=\"hljs-title\"\u003egetProgramName\u003c/span\u003e \u003cspan class=\"hljs-params\"\u003e(\u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e index)\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eoverride\u003c/span\u003e\u003c/span\u003e;\r\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-type\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003echangeProgramName\u003c/span\u003e \u003cspan class=\"hljs-params\"\u003e(\u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e index, \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e juce::String\u0026#x26; newName)\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eoverride\u003c/span\u003e\u003c/span\u003e;\r\n\r\n    \u003cspan class=\"hljs-comment\"\u003e//==============================================================================\u003c/span\u003e\r\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-type\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003egetStateInformation\u003c/span\u003e \u003cspan class=\"hljs-params\"\u003e(juce::MemoryBlock\u0026#x26; destData)\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eoverride\u003c/span\u003e\u003c/span\u003e;\r\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-type\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003esetStateInformation\u003c/span\u003e \u003cspan class=\"hljs-params\"\u003e(\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"hljs-type\"\u003evoid\u003c/span\u003e* data, \u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e sizeInBytes)\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eoverride\u003c/span\u003e\u003c/span\u003e;\r\n\r\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-type\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eparameterChanged\u003c/span\u003e \u003cspan class=\"hljs-params\"\u003e(\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e juce::String\u0026#x26; parameterID, \u003cspan class=\"hljs-type\"\u003efloat\u003c/span\u003e newValue)\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eoverride\u003c/span\u003e\u003c/span\u003e;\r\n\r\n\u003cspan class=\"hljs-keyword\"\u003eprivate\u003c/span\u003e:\r\n    \u003cspan class=\"hljs-comment\"\u003e//==============================================================================\u003c/span\u003e\r\n    juce::AudioProcessorValueTreeState apvts;\r\n    juce::UndoManager undoManager;\r\n\r\n    RNBO::CoreObject rnboObject;\r\n\r\n    std::unordered_map\u0026#x3C;juce::String, RNBO::ParameterIndex\u003e apvtsParamIdToRnboParamIndex;\r\n\r\n    \u003cspan class=\"hljs-built_in\"\u003eJUCE_DECLARE_NON_COPYABLE_WITH_LEAK_DETECTOR\u003c/span\u003e (JRGranularAudioProcessor)\r\n};\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"rehype-code-title\"\u003ePluginProcessor.cpp\u003c/div\u003e\u003cpre\u003e\u003ccode class=\"hljs language-C++\"\u003e\u003cspan class=\"hljs-meta\"\u003e#\u003cspan class=\"hljs-keyword\"\u003einclude\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"PluginProcessor.h\"\u003c/span\u003e\u003c/span\u003e\r\n\u003cspan class=\"hljs-meta\"\u003e#\u003cspan class=\"hljs-keyword\"\u003einclude\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"PluginEditor.h\"\u003c/span\u003e\u003c/span\u003e\r\n\u003cspan class=\"hljs-meta\"\u003e#\u003cspan class=\"hljs-keyword\"\u003einclude\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"ParamIDs.h\"\u003c/span\u003e\u003c/span\u003e\r\n\r\n\u003cspan class=\"hljs-keyword\"\u003estatic\u003c/span\u003e juce::\u003cspan class=\"hljs-function\"\u003eAudioProcessorValueTreeState::ParameterLayout \u003cspan class=\"hljs-title\"\u003ecreateParameterLayout\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e\r\n\u003c/span\u003e{\r\n    juce::AudioProcessorValueTreeState::ParameterLayout layout;\r\n\r\n    \u003cspan class=\"hljs-keyword\"\u003eauto\u003c/span\u003e msFormat = [](\u003cspan class=\"hljs-type\"\u003efloat\u003c/span\u003e value, \u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e)\r\n    {\r\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (value \u0026#x3C; \u003cspan class=\"hljs-number\"\u003e100.0f\u003c/span\u003e)\r\n            \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e juce::\u003cspan class=\"hljs-built_in\"\u003eString\u003c/span\u003e (value, \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e) + \u003cspan class=\"hljs-string\"\u003e\" ms\"\u003c/span\u003e;\r\n        \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e\r\n            \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e juce::\u003cspan class=\"hljs-built_in\"\u003eString\u003c/span\u003e (std::\u003cspan class=\"hljs-built_in\"\u003eroundf\u003c/span\u003e (value)) + \u003cspan class=\"hljs-string\"\u003e\" ms\"\u003c/span\u003e;\r\n    };\r\n\r\n    layout.\u003cspan class=\"hljs-built_in\"\u003eadd\u003c/span\u003e (std::\u003cspan class=\"hljs-built_in\"\u003emake_unique\u003c/span\u003e\u0026#x3C;juce::AudioParameterFloat\u003e (juce::ParameterID { ParamIDs::interval, \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e },\r\n                                                             \u003cspan class=\"hljs-string\"\u003e\"intv\"\u003c/span\u003e,\r\n                                                             juce::\u003cspan class=\"hljs-built_in\"\u003eNormalisableRange\u003c/span\u003e\u0026#x3C;\u003cspan class=\"hljs-type\"\u003efloat\u003c/span\u003e\u003e (\u003cspan class=\"hljs-number\"\u003e10.0f\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e500.0f\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0.01f\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0.405f\u003c/span\u003e),\r\n                                                             \u003cspan class=\"hljs-number\"\u003e100.0f\u003c/span\u003e,\r\n                                                             juce::\u003cspan class=\"hljs-built_in\"\u003eString\u003c/span\u003e(),\r\n                                                             juce::AudioProcessorParameter::genericParameter,\r\n                                                             msFormat,\r\n                                                             \u003cspan class=\"hljs-literal\"\u003enullptr\u003c/span\u003e));\r\n\r\n    layout.\u003cspan class=\"hljs-built_in\"\u003eadd\u003c/span\u003e (std::\u003cspan class=\"hljs-built_in\"\u003emake_unique\u003c/span\u003e\u0026#x3C;juce::AudioParameterFloat\u003e (juce::ParameterID { ParamIDs::pitch, \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e }, \r\n                                                             ParamIDs::pitch,\r\n                                                             juce::\u003cspan class=\"hljs-built_in\"\u003eNormalisableRange\u003c/span\u003e\u0026#x3C;\u003cspan class=\"hljs-type\"\u003efloat\u003c/span\u003e\u003e (\u003cspan class=\"hljs-number\"\u003e-12.0f\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e12.0f\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0.1f\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e1.0f\u003c/span\u003e),\r\n                                                             \u003cspan class=\"hljs-number\"\u003e0.0f\u003c/span\u003e,\r\n                                                             juce::\u003cspan class=\"hljs-built_in\"\u003eString\u003c/span\u003e(),\r\n                                                             juce::AudioProcessorParameter::genericParameter,\r\n                                                             [](\u003cspan class=\"hljs-type\"\u003efloat\u003c/span\u003e value, \u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e) {\r\n                                                                \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e juce::\u003cspan class=\"hljs-built_in\"\u003eString\u003c/span\u003e (value, \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e) + \u003cspan class=\"hljs-string\"\u003e\" st\"\u003c/span\u003e; },\r\n                                                             \u003cspan class=\"hljs-literal\"\u003enullptr\u003c/span\u003e));\r\n\r\n    layout.\u003cspan class=\"hljs-built_in\"\u003eadd\u003c/span\u003e (std::\u003cspan class=\"hljs-built_in\"\u003emake_unique\u003c/span\u003e\u0026#x3C;juce::AudioParameterFloat\u003e (juce::ParameterID { ParamIDs::grainPos, \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e }, \r\n                                                             \u003cspan class=\"hljs-string\"\u003e\"pos\"\u003c/span\u003e,\r\n                                                             juce::\u003cspan class=\"hljs-built_in\"\u003eNormalisableRange\u003c/span\u003e\u0026#x3C;\u003cspan class=\"hljs-type\"\u003efloat\u003c/span\u003e\u003e (\u003cspan class=\"hljs-number\"\u003e10.0f\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e500.0f\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e1.0f\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0.405f\u003c/span\u003e),\r\n                                                             \u003cspan class=\"hljs-number\"\u003e100.0f\u003c/span\u003e,\r\n                                                             juce::\u003cspan class=\"hljs-built_in\"\u003eString\u003c/span\u003e(),\r\n                                                             juce::AudioProcessorParameter::genericParameter,\r\n                                                             msFormat,\r\n                                                             \u003cspan class=\"hljs-literal\"\u003enullptr\u003c/span\u003e));\r\n\r\n    layout.\u003cspan class=\"hljs-built_in\"\u003eadd\u003c/span\u003e (std::\u003cspan class=\"hljs-built_in\"\u003emake_unique\u003c/span\u003e\u0026#x3C;juce::AudioParameterFloat\u003e (juce::ParameterID { ParamIDs::grainSize, \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e }, \r\n                                                             \u003cspan class=\"hljs-string\"\u003e\"size\"\u003c/span\u003e,\r\n                                                             juce::\u003cspan class=\"hljs-built_in\"\u003eNormalisableRange\u003c/span\u003e\u0026#x3C;\u003cspan class=\"hljs-type\"\u003efloat\u003c/span\u003e\u003e (\u003cspan class=\"hljs-number\"\u003e10.0f\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e500.0f\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0.01f\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0.405f\u003c/span\u003e),\r\n                                                             \u003cspan class=\"hljs-number\"\u003e100.0f\u003c/span\u003e,\r\n                                                             juce::\u003cspan class=\"hljs-built_in\"\u003eString\u003c/span\u003e(),\r\n                                                             juce::AudioProcessorParameter::genericParameter,\r\n                                                             msFormat,\r\n                                                             \u003cspan class=\"hljs-literal\"\u003enullptr\u003c/span\u003e));\r\n\r\n    \u003cspan class=\"hljs-keyword\"\u003eauto\u003c/span\u003e percentFormat = [](\u003cspan class=\"hljs-type\"\u003efloat\u003c/span\u003e value, \u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e)\r\n    {\r\n         \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (value \u0026#x3C; \u003cspan class=\"hljs-number\"\u003e10.0f\u003c/span\u003e)\r\n             \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e juce::\u003cspan class=\"hljs-built_in\"\u003eString\u003c/span\u003e (value, \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e) + \u003cspan class=\"hljs-string\"\u003e\" %\"\u003c/span\u003e;\r\n         \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (value \u0026#x3C; \u003cspan class=\"hljs-number\"\u003e100.0f\u003c/span\u003e)\r\n             \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e juce::\u003cspan class=\"hljs-built_in\"\u003eString\u003c/span\u003e (value, \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e) + \u003cspan class=\"hljs-string\"\u003e\" %\"\u003c/span\u003e;\r\n         \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e\r\n             \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e juce::\u003cspan class=\"hljs-built_in\"\u003eString\u003c/span\u003e (value, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e) + \u003cspan class=\"hljs-string\"\u003e\" %\"\u003c/span\u003e; \r\n    };\r\n\r\n    layout.\u003cspan class=\"hljs-built_in\"\u003eadd\u003c/span\u003e (std::\u003cspan class=\"hljs-built_in\"\u003emake_unique\u003c/span\u003e\u0026#x3C;juce::AudioParameterFloat\u003e (juce::ParameterID { ParamIDs::mix, \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e }, \r\n                                                             ParamIDs::mix,\r\n                                                             juce::\u003cspan class=\"hljs-built_in\"\u003eNormalisableRange\u003c/span\u003e\u0026#x3C;\u003cspan class=\"hljs-type\"\u003efloat\u003c/span\u003e\u003e (\u003cspan class=\"hljs-number\"\u003e0.0f\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e100.0f\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0.01f\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e1.0f\u003c/span\u003e),\r\n                                                             \u003cspan class=\"hljs-number\"\u003e50.0f\u003c/span\u003e,\r\n                                                             juce::\u003cspan class=\"hljs-built_in\"\u003eString\u003c/span\u003e(),\r\n                                                             juce::AudioProcessorParameter::genericParameter,\r\n                                                             percentFormat,\r\n                                                             \u003cspan class=\"hljs-literal\"\u003enullptr\u003c/span\u003e));\r\n\r\n    layout.\u003cspan class=\"hljs-built_in\"\u003eadd\u003c/span\u003e (std::\u003cspan class=\"hljs-built_in\"\u003emake_unique\u003c/span\u003e\u0026#x3C;juce::AudioParameterFloat\u003e (juce::ParameterID { ParamIDs::width, \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e }, \r\n                                                             ParamIDs::width,\r\n                                                             juce::\u003cspan class=\"hljs-built_in\"\u003eNormalisableRange\u003c/span\u003e\u0026#x3C;\u003cspan class=\"hljs-type\"\u003efloat\u003c/span\u003e\u003e (\u003cspan class=\"hljs-number\"\u003e0.0f\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e100.0f\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0.01f\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e1.0f\u003c/span\u003e),\r\n                                                             \u003cspan class=\"hljs-number\"\u003e50.0\u003c/span\u003e,\r\n                                                             juce::\u003cspan class=\"hljs-built_in\"\u003eString\u003c/span\u003e(),\r\n                                                             juce::AudioProcessorParameter::genericParameter,\r\n                                                             percentFormat,\r\n                                                             \u003cspan class=\"hljs-literal\"\u003enullptr\u003c/span\u003e));\r\n\r\n    layout.\u003cspan class=\"hljs-built_in\"\u003eadd\u003c/span\u003e (std::\u003cspan class=\"hljs-built_in\"\u003emake_unique\u003c/span\u003e\u0026#x3C;juce::AudioParameterFloat\u003e (juce::ParameterID { ParamIDs::gain, \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e }, \r\n                                                             \u003cspan class=\"hljs-string\"\u003e\"vol\"\u003c/span\u003e,\r\n                                                             juce::\u003cspan class=\"hljs-built_in\"\u003eNormalisableRange\u003c/span\u003e\u0026#x3C;\u003cspan class=\"hljs-type\"\u003efloat\u003c/span\u003e\u003e (\u003cspan class=\"hljs-number\"\u003e-36.0f\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e12.0f\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0.1f\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e2.4f\u003c/span\u003e),\r\n                                                             \u003cspan class=\"hljs-number\"\u003e0.0f\u003c/span\u003e,\r\n                                                             juce::\u003cspan class=\"hljs-built_in\"\u003eString\u003c/span\u003e(),\r\n                                                             juce::AudioProcessorParameter::genericParameter,\r\n                                                             [](\u003cspan class=\"hljs-type\"\u003efloat\u003c/span\u003e value, \u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e) {\r\n                                                             \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (\u003cspan class=\"hljs-number\"\u003e-10.0f\u003c/span\u003e \u0026#x3C; value \u0026#x26;\u0026#x26; value \u0026#x3C; \u003cspan class=\"hljs-number\"\u003e10.0f\u003c/span\u003e)\r\n                                                                 \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e juce::\u003cspan class=\"hljs-built_in\"\u003eString\u003c/span\u003e (value, \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e) + \u003cspan class=\"hljs-string\"\u003e\" dB\"\u003c/span\u003e;\r\n                                                             \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e\r\n                                                                 \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e juce::\u003cspan class=\"hljs-built_in\"\u003eString\u003c/span\u003e (std::\u003cspan class=\"hljs-built_in\"\u003eroundf\u003c/span\u003e (value), \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e) + \u003cspan class=\"hljs-string\"\u003e\" dB\"\u003c/span\u003e; },\r\n                                                             \u003cspan class=\"hljs-literal\"\u003enullptr\u003c/span\u003e));\r\n\r\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e layout;\r\n}\r\n\r\n\u003cspan class=\"hljs-comment\"\u003e//==============================================================================\u003c/span\u003e\r\nJRGranularAudioProcessor::\u003cspan class=\"hljs-built_in\"\u003eJRGranularAudioProcessor\u003c/span\u003e()\r\n\u003cspan class=\"hljs-meta\"\u003e#\u003cspan class=\"hljs-keyword\"\u003eifndef\u003c/span\u003e JucePlugin_PreferredChannelConfigurations\u003c/span\u003e\r\n     : \u003cspan class=\"hljs-built_in\"\u003eAudioProcessor\u003c/span\u003e (\u003cspan class=\"hljs-built_in\"\u003eBusesProperties\u003c/span\u003e()\r\n                     \u003cspan class=\"hljs-meta\"\u003e#\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e ! JucePlugin_IsMidiEffect\u003c/span\u003e\r\n                      \u003cspan class=\"hljs-meta\"\u003e#\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e ! JucePlugin_IsSynth\u003c/span\u003e\r\n                       .\u003cspan class=\"hljs-built_in\"\u003ewithInput\u003c/span\u003e  (\u003cspan class=\"hljs-string\"\u003e\"Input\"\u003c/span\u003e,  juce::AudioChannelSet::\u003cspan class=\"hljs-built_in\"\u003estereo\u003c/span\u003e(), \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e)\r\n                      \u003cspan class=\"hljs-meta\"\u003e#\u003cspan class=\"hljs-keyword\"\u003eendif\u003c/span\u003e\u003c/span\u003e\r\n                       .\u003cspan class=\"hljs-built_in\"\u003ewithOutput\u003c/span\u003e (\u003cspan class=\"hljs-string\"\u003e\"Output\"\u003c/span\u003e, juce::AudioChannelSet::\u003cspan class=\"hljs-built_in\"\u003estereo\u003c/span\u003e(), \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e)\r\n                     \u003cspan class=\"hljs-meta\"\u003e#\u003cspan class=\"hljs-keyword\"\u003eendif\u003c/span\u003e\u003c/span\u003e\r\n                       ),\r\n\u003cspan class=\"hljs-meta\"\u003e#\u003cspan class=\"hljs-keyword\"\u003eendif\u003c/span\u003e\u003c/span\u003e\r\n       \u003cspan class=\"hljs-built_in\"\u003eapvts\u003c/span\u003e (*\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e, \u0026#x26;undoManager, \u003cspan class=\"hljs-string\"\u003e\"Parameters\"\u003c/span\u003e, \u003cspan class=\"hljs-built_in\"\u003ecreateParameterLayout\u003c/span\u003e())\r\n{\r\n    \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e (RNBO::ParameterIndex i = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e; i \u0026#x3C; rnboObject.\u003cspan class=\"hljs-built_in\"\u003egetNumParameters\u003c/span\u003e(); ++i)\r\n    {\r\n        RNBO::ParameterInfo info;\r\n        rnboObject.\u003cspan class=\"hljs-built_in\"\u003egetParameterInfo\u003c/span\u003e (i, \u0026#x26;info);\r\n\r\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (info.visible)\r\n        {\r\n            \u003cspan class=\"hljs-keyword\"\u003eauto\u003c/span\u003e paramID = juce::\u003cspan class=\"hljs-built_in\"\u003eString\u003c/span\u003e (rnboObject.\u003cspan class=\"hljs-built_in\"\u003egetParameterId\u003c/span\u003e (i));\r\n\r\n            \u003cspan class=\"hljs-comment\"\u003e// Each apvts parameter id and range must be the same as the rnbo param object's.\u003c/span\u003e\r\n            \u003cspan class=\"hljs-comment\"\u003e// If you hit this assertion then you need to fix the incorrect id in ParamIDs.h.\u003c/span\u003e\r\n            \u003cspan class=\"hljs-built_in\"\u003ejassert\u003c/span\u003e (apvts.\u003cspan class=\"hljs-built_in\"\u003egetParameter\u003c/span\u003e (paramID) != \u003cspan class=\"hljs-literal\"\u003enullptr\u003c/span\u003e);  \r\n\r\n            \u003cspan class=\"hljs-comment\"\u003e// If you hit these assertions then you need to fix the incorrect apvts \u003c/span\u003e\r\n            \u003cspan class=\"hljs-comment\"\u003e// parameter range in createParameterLayout().\u003c/span\u003e\r\n            \u003cspan class=\"hljs-built_in\"\u003ejassert\u003c/span\u003e (info.min == apvts.\u003cspan class=\"hljs-built_in\"\u003egetParameterRange\u003c/span\u003e (paramID).start);\r\n            \u003cspan class=\"hljs-built_in\"\u003ejassert\u003c/span\u003e (info.max == apvts.\u003cspan class=\"hljs-built_in\"\u003egetParameterRange\u003c/span\u003e (paramID).end);\r\n\r\n            apvtsParamIdToRnboParamIndex[paramID] = i;\r\n\r\n            apvts.\u003cspan class=\"hljs-built_in\"\u003eaddParameterListener\u003c/span\u003e (paramID, \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e);\r\n            rnboObject.\u003cspan class=\"hljs-built_in\"\u003esetParameterValue\u003c/span\u003e (i, apvts.\u003cspan class=\"hljs-built_in\"\u003egetRawParameterValue\u003c/span\u003e (paramID)-\u003e\u003cspan class=\"hljs-built_in\"\u003eload\u003c/span\u003e());\r\n        }\r\n    }\r\n}\r\n\r\nJRGranularAudioProcessor::~\u003cspan class=\"hljs-built_in\"\u003eJRGranularAudioProcessor\u003c/span\u003e()\r\n{\r\n}\r\n\r\n\u003cspan class=\"hljs-comment\"\u003e//==============================================================================\u003c/span\u003e\r\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e juce::String \u003cspan class=\"hljs-title\"\u003eJRGranularAudioProcessor::getName\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e\r\n\u003c/span\u003e{\r\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e JucePlugin_Name;\r\n}\r\n\r\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-type\"\u003ebool\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eJRGranularAudioProcessor::acceptsMidi\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e\r\n\u003c/span\u003e{\r\n   \u003cspan class=\"hljs-meta\"\u003e#\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e JucePlugin_WantsMidiInput\u003c/span\u003e\r\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e;\r\n   \u003cspan class=\"hljs-meta\"\u003e#\u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e\u003c/span\u003e\r\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e;\r\n   \u003cspan class=\"hljs-meta\"\u003e#\u003cspan class=\"hljs-keyword\"\u003eendif\u003c/span\u003e\u003c/span\u003e\r\n}\r\n\r\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-type\"\u003ebool\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eJRGranularAudioProcessor::producesMidi\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e\r\n\u003c/span\u003e{\r\n   \u003cspan class=\"hljs-meta\"\u003e#\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e JucePlugin_ProducesMidiOutput\u003c/span\u003e\r\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e;\r\n   \u003cspan class=\"hljs-meta\"\u003e#\u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e\u003c/span\u003e\r\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e;\r\n   \u003cspan class=\"hljs-meta\"\u003e#\u003cspan class=\"hljs-keyword\"\u003eendif\u003c/span\u003e\u003c/span\u003e\r\n}\r\n\r\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-type\"\u003ebool\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eJRGranularAudioProcessor::isMidiEffect\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e\r\n\u003c/span\u003e{\r\n   \u003cspan class=\"hljs-meta\"\u003e#\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e JucePlugin_IsMidiEffect\u003c/span\u003e\r\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e;\r\n   \u003cspan class=\"hljs-meta\"\u003e#\u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e\u003c/span\u003e\r\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e;\r\n   \u003cspan class=\"hljs-meta\"\u003e#\u003cspan class=\"hljs-keyword\"\u003eendif\u003c/span\u003e\u003c/span\u003e\r\n}\r\n\r\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-type\"\u003edouble\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eJRGranularAudioProcessor::getTailLengthSeconds\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e\r\n\u003c/span\u003e{\r\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e0.0\u003c/span\u003e;\r\n}\r\n\r\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eJRGranularAudioProcessor::getNumPrograms\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e\r\n\u003c/span\u003e{\r\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e;   \u003cspan class=\"hljs-comment\"\u003e// NB: some hosts don't cope very well if you tell them there are 0 programs,\u003c/span\u003e\r\n                \u003cspan class=\"hljs-comment\"\u003e// so this should be at least 1, even if you're not really implementing programs.\u003c/span\u003e\r\n}\r\n\r\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eJRGranularAudioProcessor::getCurrentProgram\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e\r\n\u003c/span\u003e{\r\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e;\r\n}\r\n\r\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-type\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eJRGranularAudioProcessor::setCurrentProgram\u003c/span\u003e \u003cspan class=\"hljs-params\"\u003e(\u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e index)\u003c/span\u003e\r\n\u003c/span\u003e{\r\n    juce::\u003cspan class=\"hljs-built_in\"\u003eignoreUnused\u003c/span\u003e (index);\r\n}\r\n\r\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e juce::String \u003cspan class=\"hljs-title\"\u003eJRGranularAudioProcessor::getProgramName\u003c/span\u003e \u003cspan class=\"hljs-params\"\u003e(\u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e index)\u003c/span\u003e\r\n\u003c/span\u003e{\r\n    juce::\u003cspan class=\"hljs-built_in\"\u003eignoreUnused\u003c/span\u003e (index);\r\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e {};\r\n}\r\n\r\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-type\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eJRGranularAudioProcessor::changeProgramName\u003c/span\u003e \u003cspan class=\"hljs-params\"\u003e(\u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e index, \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e juce::String\u0026#x26; newName)\u003c/span\u003e\r\n\u003c/span\u003e{\r\n    juce::\u003cspan class=\"hljs-built_in\"\u003eignoreUnused\u003c/span\u003e (index, newName);\r\n}\r\n\r\n\u003cspan class=\"hljs-comment\"\u003e//==============================================================================\u003c/span\u003e\r\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-type\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eJRGranularAudioProcessor::prepareToPlay\u003c/span\u003e \u003cspan class=\"hljs-params\"\u003e(\u003cspan class=\"hljs-type\"\u003edouble\u003c/span\u003e sampleRate, \u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e samplesPerBlock)\u003c/span\u003e\r\n\u003c/span\u003e{\r\n    rnboObject.\u003cspan class=\"hljs-built_in\"\u003eprepareToProcess\u003c/span\u003e (sampleRate, \u003cspan class=\"hljs-built_in\"\u003estatic_cast\u003c/span\u003e\u0026#x3C;\u003cspan class=\"hljs-type\"\u003esize_t\u003c/span\u003e\u003e (samplesPerBlock));\r\n}\r\n\r\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-type\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eJRGranularAudioProcessor::releaseResources\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e\r\n\u003c/span\u003e{\r\n    \u003cspan class=\"hljs-comment\"\u003e// When playback stops, you can use this as an opportunity to free up any\u003c/span\u003e\r\n    \u003cspan class=\"hljs-comment\"\u003e// spare memory, etc.\u003c/span\u003e\r\n}\r\n\r\n\u003cspan class=\"hljs-meta\"\u003e#\u003cspan class=\"hljs-keyword\"\u003eifndef\u003c/span\u003e JucePlugin_PreferredChannelConfigurations\u003c/span\u003e\r\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-type\"\u003ebool\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eJRGranularAudioProcessor::isBusesLayoutSupported\u003c/span\u003e \u003cspan class=\"hljs-params\"\u003e(\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e BusesLayout\u0026#x26; layouts)\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e\r\n\u003c/span\u003e{\r\n  \u003cspan class=\"hljs-meta\"\u003e#\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e JucePlugin_IsMidiEffect\u003c/span\u003e\r\n    juce::\u003cspan class=\"hljs-built_in\"\u003eignoreUnused\u003c/span\u003e (layouts);\r\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e;\r\n  \u003cspan class=\"hljs-meta\"\u003e#\u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e\u003c/span\u003e\r\n    \u003cspan class=\"hljs-comment\"\u003e// This is the place where you check if the layout is supported.\u003c/span\u003e\r\n    \u003cspan class=\"hljs-comment\"\u003e// In this template code we only support mono or stereo.\u003c/span\u003e\r\n    \u003cspan class=\"hljs-comment\"\u003e// Some plugin hosts, such as certain GarageBand versions, will only\u003c/span\u003e\r\n    \u003cspan class=\"hljs-comment\"\u003e// load plugins that support stereo bus layouts.\u003c/span\u003e\r\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (layouts.\u003cspan class=\"hljs-built_in\"\u003egetMainOutputChannelSet\u003c/span\u003e() != juce::AudioChannelSet::\u003cspan class=\"hljs-built_in\"\u003emono\u003c/span\u003e()\r\n     \u0026#x26;\u0026#x26; layouts.\u003cspan class=\"hljs-built_in\"\u003egetMainOutputChannelSet\u003c/span\u003e() != juce::AudioChannelSet::\u003cspan class=\"hljs-built_in\"\u003estereo\u003c/span\u003e())\r\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e;\r\n\r\n    \u003cspan class=\"hljs-comment\"\u003e// This checks if the input layout matches the output layout\u003c/span\u003e\r\n   \u003cspan class=\"hljs-meta\"\u003e#\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e ! JucePlugin_IsSynth\u003c/span\u003e\r\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (layouts.\u003cspan class=\"hljs-built_in\"\u003egetMainOutputChannelSet\u003c/span\u003e() != layouts.\u003cspan class=\"hljs-built_in\"\u003egetMainInputChannelSet\u003c/span\u003e())\r\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e;\r\n   \u003cspan class=\"hljs-meta\"\u003e#\u003cspan class=\"hljs-keyword\"\u003eendif\u003c/span\u003e\u003c/span\u003e\r\n\r\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e;\r\n  \u003cspan class=\"hljs-meta\"\u003e#\u003cspan class=\"hljs-keyword\"\u003eendif\u003c/span\u003e\u003c/span\u003e\r\n}\r\n\u003cspan class=\"hljs-meta\"\u003e#\u003cspan class=\"hljs-keyword\"\u003eendif\u003c/span\u003e\u003c/span\u003e\r\n\r\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-type\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eJRGranularAudioProcessor::processBlock\u003c/span\u003e \u003cspan class=\"hljs-params\"\u003e(juce::AudioBuffer\u0026#x3C;\u003cspan class=\"hljs-type\"\u003efloat\u003c/span\u003e\u003e\u0026#x26; buffer, juce::MidiBuffer\u0026#x26; midiMessages)\u003c/span\u003e\r\n\u003c/span\u003e{\r\n    juce::\u003cspan class=\"hljs-built_in\"\u003eignoreUnused\u003c/span\u003e (midiMessages);\r\n    \u003cspan class=\"hljs-keyword\"\u003eauto\u003c/span\u003e bufferSize = buffer.\u003cspan class=\"hljs-built_in\"\u003egetNumSamples\u003c/span\u003e();\r\n\r\n    rnboObject.\u003cspan class=\"hljs-built_in\"\u003eprepareToProcess\u003c/span\u003e (\u003cspan class=\"hljs-built_in\"\u003egetSampleRate\u003c/span\u003e(), \r\n                                 \u003cspan class=\"hljs-built_in\"\u003estatic_cast\u003c/span\u003e\u0026#x3C;\u003cspan class=\"hljs-type\"\u003esize_t\u003c/span\u003e\u003e (bufferSize));\r\n\r\n    rnboObject.\u003cspan class=\"hljs-built_in\"\u003eprocess\u003c/span\u003e (buffer.\u003cspan class=\"hljs-built_in\"\u003egetArrayOfWritePointers\u003c/span\u003e(),\r\n                        \u003cspan class=\"hljs-built_in\"\u003estatic_cast\u003c/span\u003e\u0026#x3C;RNBO::Index\u003e (buffer.\u003cspan class=\"hljs-built_in\"\u003egetNumChannels\u003c/span\u003e()),\r\n                        buffer.\u003cspan class=\"hljs-built_in\"\u003egetArrayOfWritePointers\u003c/span\u003e(),\r\n                        \u003cspan class=\"hljs-built_in\"\u003estatic_cast\u003c/span\u003e\u0026#x3C;RNBO::Index\u003e (buffer.\u003cspan class=\"hljs-built_in\"\u003egetNumChannels\u003c/span\u003e()),\r\n                        \u003cspan class=\"hljs-built_in\"\u003estatic_cast\u003c/span\u003e\u0026#x3C;RNBO::Index\u003e (bufferSize));\r\n}\r\n\r\n\u003cspan class=\"hljs-comment\"\u003e//==============================================================================\u003c/span\u003e\r\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-type\"\u003ebool\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eJRGranularAudioProcessor::hasEditor\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e\r\n\u003c/span\u003e{\r\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e; \u003cspan class=\"hljs-comment\"\u003e// (change this to false if you choose to not supply an editor)\u003c/span\u003e\r\n}\r\n\r\n\u003cspan class=\"hljs-function\"\u003ejuce::AudioProcessorEditor* \u003cspan class=\"hljs-title\"\u003eJRGranularAudioProcessor::createEditor\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e\r\n\u003c/span\u003e{\r\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003eJRGranularAudioProcessorEditor\u003c/span\u003e (*\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e, apvts, undoManager);\r\n    \u003cspan class=\"hljs-comment\"\u003e/* return new juce::GenericAudioProcessorEditor (*this); */\u003c/span\u003e\r\n}\r\n\r\n\u003cspan class=\"hljs-comment\"\u003e//==============================================================================\u003c/span\u003e\r\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-type\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eJRGranularAudioProcessor::getStateInformation\u003c/span\u003e \u003cspan class=\"hljs-params\"\u003e(juce::MemoryBlock\u0026#x26; destData)\u003c/span\u003e\r\n\u003c/span\u003e{\r\n    \u003cspan class=\"hljs-function\"\u003ejuce::MemoryOutputStream \u003cspan class=\"hljs-title\"\u003emos\u003c/span\u003e \u003cspan class=\"hljs-params\"\u003e(destData, \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e)\u003c/span\u003e\u003c/span\u003e;\r\n    apvts.state.\u003cspan class=\"hljs-built_in\"\u003ewriteToStream\u003c/span\u003e (mos);\r\n}\r\n\r\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-type\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eJRGranularAudioProcessor::setStateInformation\u003c/span\u003e \u003cspan class=\"hljs-params\"\u003e(\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"hljs-type\"\u003evoid\u003c/span\u003e* data, \u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e sizeInBytes)\u003c/span\u003e\r\n\u003c/span\u003e{\r\n    \u003cspan class=\"hljs-keyword\"\u003eauto\u003c/span\u003e tree = juce::ValueTree::\u003cspan class=\"hljs-built_in\"\u003ereadFromData\u003c/span\u003e (data, \u003cspan class=\"hljs-built_in\"\u003estatic_cast\u003c/span\u003e\u0026#x3C;\u003cspan class=\"hljs-type\"\u003esize_t\u003c/span\u003e\u003e (sizeInBytes));\r\n\r\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (tree.\u003cspan class=\"hljs-built_in\"\u003eisValid\u003c/span\u003e())\r\n        apvts.\u003cspan class=\"hljs-built_in\"\u003ereplaceState\u003c/span\u003e (tree);\r\n}\r\n\r\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-type\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eJRGranularAudioProcessor::parameterChanged\u003c/span\u003e \u003cspan class=\"hljs-params\"\u003e(\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e juce::String\u0026#x26; parameterID, \u003cspan class=\"hljs-type\"\u003efloat\u003c/span\u003e newValue)\u003c/span\u003e\r\n\u003c/span\u003e{\r\n    rnboObject.\u003cspan class=\"hljs-built_in\"\u003esetParameterValue\u003c/span\u003e (apvtsParamIdToRnboParamIndex[parameterID], newValue);\r\n}\r\n\r\n\u003cspan class=\"hljs-comment\"\u003e//==============================================================================\u003c/span\u003e\r\n\u003cspan class=\"hljs-comment\"\u003e// This creates new instances of the plugin..\u003c/span\u003e\r\n\u003cspan class=\"hljs-function\"\u003ejuce::AudioProcessor* JUCE_CALLTYPE \u003cspan class=\"hljs-title\"\u003ecreatePluginFilter\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e\r\n\u003c/span\u003e{\r\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003eJRGranularAudioProcessor\u003c/span\u003e();\r\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eNow you have completed the minimum configuration required to link the exported code to JUCE.\u003c/p\u003e\n\u003ch2 id=\"genericaudioprocessoreditor\"\u003eGenericAudioProcessorEditor\u003c/h2\u003e\n\u003cp\u003eUsing juce::GenericAudioProcessorEditor, you can quickly build the plugin without implementing the UI. Edit the following and build it.\u003c/p\u003e\n\u003cdiv class=\"rehype-code-title\"\u003ePluginProcessor.cpp\u003c/div\u003e\u003cpre\u003e\u003ccode class=\"hljs language-C++\"\u003e\u003cspan class=\"hljs-function\"\u003ejuce::AudioProcessorEditor* \u003cspan class=\"hljs-title\"\u003eJRGranularAudioProcessor::createEditor\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e\r\n\u003c/span\u003e{\r\n    \u003cspan class=\"hljs-comment\"\u003e/* return new JRGranularAudioProcessorEditor (*this, apvts, undoManager); */\u003c/span\u003e\r\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e juce::\u003cspan class=\"hljs-built_in\"\u003eGenericAudioProcessorEditor\u003c/span\u003e (*\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e);\r\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"rehype-code-title\"\u003eCommandLine\u003c/div\u003e\u003cpre\u003e\u003ccode class=\"hljs language-text\"\u003e$ rm -rf build\r\n$ cmake -S . -B build -DCMAKE_BUILD_TYPE=Release\r\n$ cmake --build build --config Release\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eAfter the successful build, you can run the VST3/AU plugin on your DAW.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/jr-granular/generic-editor.png\" alt=\"generic-editor.png\"\u003e\u003c/p\u003e\n\u003ch2 id=\"customising-the-juce-ui\"\u003eCustomising the JUCE UI\u003c/h2\u003e\n\u003ch3 id=\"preparing-for-the-customisation\"\u003ePreparing for the customisation\u003c/h3\u003e\n\u003cp\u003eWe will use the plugin editor, so disable the GenericAudioProcessorEditor:\u003c/p\u003e\n\u003cdiv class=\"rehype-code-title\"\u003ePluginProcessor.cpp\u003c/div\u003e\u003cpre\u003e\u003ccode class=\"hljs language-C++\"\u003e\u003cspan class=\"hljs-function\"\u003ejuce::AudioProcessorEditor* \u003cspan class=\"hljs-title\"\u003eJRGranularAudioProcessor::createEditor\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e\r\n\u003c/span\u003e{\r\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003eJRGranularAudioProcessorEditor\u003c/span\u003e (*\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e, apvts, undoManager);\r\n    \u003cspan class=\"hljs-comment\"\u003e/* return new juce::GenericAudioProcessorEditor (*this); */\u003c/span\u003e\r\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eCreate customised colours for use in the UI.\u003c/p\u003e\n\u003cdiv class=\"rehype-code-title\"\u003eCommandLine\u003c/div\u003e\u003cpre\u003e\u003ccode class=\"hljs language-text\"\u003e$ touch Source/MyColours.h\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"rehype-code-title\"\u003eMyColours.h\u003c/div\u003e\u003cpre\u003e\u003ccode class=\"hljs language-C++\"\u003e\u003cspan class=\"hljs-meta\"\u003e#\u003cspan class=\"hljs-keyword\"\u003epragma\u003c/span\u003e once\u003c/span\u003e\r\n\u003cspan class=\"hljs-meta\"\u003e#\u003cspan class=\"hljs-keyword\"\u003einclude\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026#x3C;JuceHeader.h\u003e\u003c/span\u003e\u003c/span\u003e\r\n\r\n\u003cspan class=\"hljs-keyword\"\u003enamespace\u003c/span\u003e MyColours\r\n{\r\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e juce::Colour blue      { \u003cspan class=\"hljs-number\"\u003e0xff6dd4ff\u003c/span\u003e };\r\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e juce::Colour cream     { \u003cspan class=\"hljs-number\"\u003e0xfff6f9e4\u003c/span\u003e };\r\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e juce::Colour grey      { \u003cspan class=\"hljs-number\"\u003e0xffa0a0a0\u003c/span\u003e };\r\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e juce::Colour midGrey   { \u003cspan class=\"hljs-number\"\u003e0xff666666\u003c/span\u003e };\r\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e juce::Colour blackGrey { \u003cspan class=\"hljs-number\"\u003e0xff353535\u003c/span\u003e };\r\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e juce::Colour black     { \u003cspan class=\"hljs-number\"\u003e0xff141414\u003c/span\u003e };\r\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e juce::Colour red       { \u003cspan class=\"hljs-number\"\u003e0xffff3f3f\u003c/span\u003e };\r\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eAfter this, your directory structure should look something like this:\r\n\u003cimg src=\"/images/jr-granular/directories.png\" alt=\"directories.png\"\u003e\u003c/p\u003e\n\u003cp\u003eEdit PluginEditor.h/cpp as follows. This section implements the Undo/Redo features and other small UI settings.\u003c/p\u003e\n\u003cdiv class=\"rehype-code-title\"\u003ePluginEditor.h\u003c/div\u003e\u003cpre\u003e\u003ccode class=\"hljs language-C++\"\u003e\u003cspan class=\"hljs-meta\"\u003e#\u003cspan class=\"hljs-keyword\"\u003einclude\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026#x3C;JuceHeader.h\u003e\u003c/span\u003e\u003c/span\u003e\r\n\u003cspan class=\"hljs-meta\"\u003e#\u003cspan class=\"hljs-keyword\"\u003einclude\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"PluginProcessor.h\"\u003c/span\u003e\u003c/span\u003e\r\n\r\n\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title hljs-class\"\u003eJRGranularAudioProcessorEditor\u003c/span\u003e  : \u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e juce::AudioProcessorEditor\r\n{\r\n\u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e:\r\n    \u003cspan class=\"hljs-built_in\"\u003eJRGranularAudioProcessorEditor\u003c/span\u003e (JRGranularAudioProcessor\u0026#x26; p,\r\n                                    juce::AudioProcessorValueTreeState\u0026#x26; state,\r\n                                    juce::UndoManager\u0026#x26; um);\r\n\r\n    ~\u003cspan class=\"hljs-built_in\"\u003eJRGranularAudioProcessorEditor\u003c/span\u003e() \u003cspan class=\"hljs-keyword\"\u003eoverride\u003c/span\u003e;\r\n\r\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-type\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003epaint\u003c/span\u003e \u003cspan class=\"hljs-params\"\u003e(juce::Graphics\u0026#x26;)\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eoverride\u003c/span\u003e\u003c/span\u003e;\r\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-type\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eresized\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eoverride\u003c/span\u003e\u003c/span\u003e;\r\n\r\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-type\"\u003ebool\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003ekeyPressed\u003c/span\u003e \u003cspan class=\"hljs-params\"\u003e(\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e juce::KeyPress\u0026#x26; key)\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eoverride\u003c/span\u003e\u003c/span\u003e;\r\n\r\n\u003cspan class=\"hljs-keyword\"\u003eprivate\u003c/span\u003e:\r\n    JRGranularAudioProcessor\u0026#x26; audioProcessor;\r\n    juce::UndoManager\u0026#x26; undoManager;\r\n\r\n    \u003cspan class=\"hljs-built_in\"\u003eJUCE_DECLARE_NON_COPYABLE_WITH_LEAK_DETECTOR\u003c/span\u003e (JRGranularAudioProcessorEditor)\r\n};\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"rehype-code-title\"\u003ePluginEditor.cpp\u003c/div\u003e\u003cpre\u003e\u003ccode class=\"hljs language-c++\"\u003e\u003cspan class=\"hljs-meta\"\u003e#\u003cspan class=\"hljs-keyword\"\u003einclude\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"PluginProcessor.h\"\u003c/span\u003e\u003c/span\u003e\r\n\u003cspan class=\"hljs-meta\"\u003e#\u003cspan class=\"hljs-keyword\"\u003einclude\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"PluginEditor.h\"\u003c/span\u003e\u003c/span\u003e\r\n\u003cspan class=\"hljs-meta\"\u003e#\u003cspan class=\"hljs-keyword\"\u003einclude\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"MyColours.h\"\u003c/span\u003e\u003c/span\u003e\r\n\r\nJRGranularAudioProcessorEditor::\u003cspan class=\"hljs-built_in\"\u003eJRGranularAudioProcessorEditor\u003c/span\u003e (JRGranularAudioProcessor\u0026#x26; p,\r\n                                                                juce::AudioProcessorValueTreeState\u0026#x26; state,\r\n                                                                juce::UndoManager\u0026#x26; um)\r\n    : \u003cspan class=\"hljs-built_in\"\u003eAudioProcessorEditor\u003c/span\u003e (\u0026#x26;p), \u003cspan class=\"hljs-built_in\"\u003eaudioProcessor\u003c/span\u003e (p), \u003cspan class=\"hljs-built_in\"\u003eundoManager\u003c/span\u003e (um)\r\n{\r\n    \u003cspan class=\"hljs-built_in\"\u003esetWantsKeyboardFocus\u003c/span\u003e (\u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e);\r\n    \u003cspan class=\"hljs-built_in\"\u003esetSize\u003c/span\u003e (\u003cspan class=\"hljs-number\"\u003e440\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e280\u003c/span\u003e);\r\n}\r\n\r\nJRGranularAudioProcessorEditor::~\u003cspan class=\"hljs-built_in\"\u003eJRGranularAudioProcessorEditor\u003c/span\u003e()\r\n{\r\n}\r\n\r\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-type\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eJRGranularAudioProcessorEditor::paint\u003c/span\u003e \u003cspan class=\"hljs-params\"\u003e(juce::Graphics\u0026#x26; g)\u003c/span\u003e\r\n\u003c/span\u003e{\r\n    g.\u003cspan class=\"hljs-built_in\"\u003efillAll\u003c/span\u003e (MyColours::black);\r\n}\r\n\r\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-type\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eJRGranularAudioProcessorEditor::resized\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e\r\n\u003c/span\u003e{\r\n}\r\n\r\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-type\"\u003ebool\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eJRGranularAudioProcessorEditor::keyPressed\u003c/span\u003e \u003cspan class=\"hljs-params\"\u003e(\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e juce::KeyPress\u0026#x26; key)\u003c/span\u003e\r\n\u003c/span\u003e{\r\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eauto\u003c/span\u003e cmdZ = juce::KeyPress { \u003cspan class=\"hljs-string\"\u003e'z'\u003c/span\u003e, juce::ModifierKeys::commandModifier, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e };\r\n\r\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (key == cmdZ \u0026#x26;\u0026#x26; undoManager.\u003cspan class=\"hljs-built_in\"\u003ecanUndo\u003c/span\u003e())\r\n    {\r\n        undoManager.\u003cspan class=\"hljs-built_in\"\u003eundo\u003c/span\u003e();\r\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e;\r\n    }\r\n\r\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eauto\u003c/span\u003e cmdShiftZ = juce::KeyPress { \u003cspan class=\"hljs-string\"\u003e'z'\u003c/span\u003e, juce::ModifierKeys::commandModifier \r\n                                                 | juce::ModifierKeys::shiftModifier, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e };\r\n\r\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (key == cmdShiftZ \u0026#x26;\u0026#x26; undoManager.\u003cspan class=\"hljs-built_in\"\u003ecanRedo\u003c/span\u003e())\r\n    {\r\n        undoManager.\u003cspan class=\"hljs-built_in\"\u003eredo\u003c/span\u003e();\r\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e;\r\n    }\r\n\r\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e;\r\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eAfter completing the above settings, build and run the standalone and you should see a black editor as shown below.\u003c/p\u003e\n\u003cdiv class=\"rehype-code-title\"\u003eCommandLine\u003c/div\u003e\u003cpre\u003e\u003ccode class=\"hljs language-text\"\u003e$ cmake -S . -B build -DCMAKE_BUILD_TYPE=Debug\r\n$ cmake --build build --config Debug\r\n$ build/JR-Granular_artefacts/Debug/Standalone/JR-Granular.app/Contents/MacOS/JR-Granular\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cimg src=\"/images/jr-granular/setting-up.png\" alt=\"setting-up.png\"\u003e\u003c/p\u003e\n\u003ch3 id=\"adding-the-custom-dial-component\"\u003eAdding the custom dial component\u003c/h3\u003e\n\u003cp\u003eThis chapter adds customised UI components.\u003c/p\u003e\n\u003cp\u003eThis Dial has the same look and feel as Ableton's Dial and reproduces equivalent features:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003evalue changes: dragging or arrow keys\u003c/li\u003e\n\u003cli\u003efine mode: shift + dragging or shift + arrow keys\u003c/li\u003e\n\u003cli\u003eedit mode: 0-9\u003c/li\u003e\n\u003cli\u003eundo: [mac] cmd + z, [win] ctrl + z\u003c/li\u003e\n\u003cli\u003eredo: [mac] cmd + shift + z, [win] ctrl + shift + z\u003c/li\u003e\n\u003cli\u003ereset: double click\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eCreate Dial.h/cpp files.\u003c/p\u003e\n\u003cdiv class=\"rehype-code-title\"\u003eCommandLine\u003c/div\u003e\u003cpre\u003e\u003ccode class=\"hljs language-text\"\u003e$ touch Source/Dial.{h,cpp}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eCopy and paste the contents of Dial.h/cpp from the link below.\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/szkkng/jr-granular/blob/main/Source/GUI/Dial.h\"\u003eDial.h\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/szkkng/jr-granular/blob/main/Source/GUI/Dial.cpp\"\u003eDial.cpp\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eAdd the following line to the CMakeLists.txt file.\u003c/p\u003e\n\u003cdiv class=\"rehype-code-title\"\u003eCMakeLists.txt\u003c/div\u003e\u003cpre\u003e\u003ccode class=\"hljs language-diff\"\u003e...\r\ntarget_sources(\"${PROJECT_NAME}\"\r\n    PRIVATE\r\n        RnboExport/rnbo_granular.cpp\r\n        RnboExport/rnbo/RNBO.cpp\r\n        Source/PluginProcessor.cpp\r\n        Source/PluginEditor.cpp\r\n\u003cspan class=\"hljs-addition\"\u003e+       Source/Dial.cpp)\u003c/span\u003e\r\n...\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eInclude the Dial.h file and declare the Dial objects.\u003c/p\u003e\n\u003cdiv class=\"rehype-code-title\"\u003ePluginEditor.h\u003c/div\u003e\u003cpre\u003e\u003ccode class=\"hljs language-c++\"\u003e\u003cspan class=\"hljs-meta\"\u003e#\u003cspan class=\"hljs-keyword\"\u003einclude\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"Dial.h\"\u003c/span\u003e\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"rehype-code-title\"\u003ePluginEditor.h\u003c/div\u003e\u003cpre\u003e\u003ccode class=\"hljs language-c++\"\u003e\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title hljs-class\"\u003eJRGranularAudioProcessorEditor\u003c/span\u003e  : \u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e juce::AudioProcessorEditor\r\n{\r\n\u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e:\r\n...\r\n\u003cspan class=\"hljs-keyword\"\u003eprivate\u003c/span\u003e:\r\n...\r\n    Dial intvDial;\r\n    Dial pitchDial;\r\n    Dial sizeDial;\r\n    Dial posDial;\r\n    Dial widthDial;\r\n    Dial mixDial;\r\n    Dial gainDial;\r\n\r\n    \u003cspan class=\"hljs-built_in\"\u003eJUCE_DECLARE_NON_COPYABLE_WITH_LEAK_DETECTOR\u003c/span\u003e (JRGranularAudioProcessorEditor)\r\n};\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eConnect the corresponding APVTS parameters to each Dial and set them to be displayed in the plugin editor.\u003c/p\u003e\n\u003cdiv class=\"rehype-code-title\"\u003ePluginEditor.cpp\u003c/div\u003e\u003cpre\u003e\u003ccode class=\"hljs language-c++\"\u003e\u003cspan class=\"hljs-meta\"\u003e#\u003cspan class=\"hljs-keyword\"\u003einclude\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"ParamIDs.h\"\u003c/span\u003e\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"rehype-code-title\"\u003ePluginEditor.cpp\u003c/div\u003e\u003cpre\u003e\u003ccode class=\"hljs language-c++\"\u003eJRGranularAudioProcessorEditor::\u003cspan class=\"hljs-built_in\"\u003eJRGranularAudioProcessorEditor\u003c/span\u003e (JRGranularAudioProcessor\u0026#x26; p,\r\n                                                                juce::AudioProcessorValueTreeState\u0026#x26; state,\r\n                                                                juce::UndoManager\u0026#x26; um)\r\n    : \u003cspan class=\"hljs-built_in\"\u003eAudioProcessorEditor\u003c/span\u003e (\u0026#x26;p), \u003cspan class=\"hljs-built_in\"\u003eaudioProcessor\u003c/span\u003e (p), \u003cspan class=\"hljs-built_in\"\u003eundoManager\u003c/span\u003e (um),\r\n      \u003cspan class=\"hljs-built_in\"\u003eintvDial\u003c/span\u003e  (*state.\u003cspan class=\"hljs-built_in\"\u003egetParameter\u003c/span\u003e (ParamIDs::interval),  um),\r\n      \u003cspan class=\"hljs-built_in\"\u003epitchDial\u003c/span\u003e (*state.\u003cspan class=\"hljs-built_in\"\u003egetParameter\u003c/span\u003e (ParamIDs::pitch),     um),\r\n      \u003cspan class=\"hljs-built_in\"\u003esizeDial\u003c/span\u003e  (*state.\u003cspan class=\"hljs-built_in\"\u003egetParameter\u003c/span\u003e (ParamIDs::grainSize), um),\r\n      \u003cspan class=\"hljs-built_in\"\u003eposDial\u003c/span\u003e   (*state.\u003cspan class=\"hljs-built_in\"\u003egetParameter\u003c/span\u003e (ParamIDs::grainPos),  um),\r\n      \u003cspan class=\"hljs-built_in\"\u003ewidthDial\u003c/span\u003e (*state.\u003cspan class=\"hljs-built_in\"\u003egetParameter\u003c/span\u003e (ParamIDs::width),     um),\r\n      \u003cspan class=\"hljs-built_in\"\u003emixDial\u003c/span\u003e   (*state.\u003cspan class=\"hljs-built_in\"\u003egetParameter\u003c/span\u003e (ParamIDs::mix),       um),\r\n      \u003cspan class=\"hljs-built_in\"\u003egainDial\u003c/span\u003e  (*state.\u003cspan class=\"hljs-built_in\"\u003egetParameter\u003c/span\u003e (ParamIDs::gain),      um)\r\n\r\n{\r\n    \u003cspan class=\"hljs-built_in\"\u003esetWantsKeyboardFocus\u003c/span\u003e (\u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e);\r\n    \u003cspan class=\"hljs-built_in\"\u003esetSize\u003c/span\u003e (\u003cspan class=\"hljs-number\"\u003e440\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e280\u003c/span\u003e);\r\n\r\n    intvDial.\u003cspan class=\"hljs-built_in\"\u003esetLabelText\u003c/span\u003e (\u003cspan class=\"hljs-string\"\u003e\"intv\"\u003c/span\u003e);\r\n    mixDial.\u003cspan class=\"hljs-built_in\"\u003esetLabelText\u003c/span\u003e  (\u003cspan class=\"hljs-string\"\u003e\"mix\"\u003c/span\u003e);\r\n    posDial.\u003cspan class=\"hljs-built_in\"\u003esetLabelText\u003c/span\u003e  (\u003cspan class=\"hljs-string\"\u003e\"pos\"\u003c/span\u003e);\r\n    sizeDial.\u003cspan class=\"hljs-built_in\"\u003esetLabelText\u003c/span\u003e (\u003cspan class=\"hljs-string\"\u003e\"size\"\u003c/span\u003e);\r\n    gainDial.\u003cspan class=\"hljs-built_in\"\u003esetLabelText\u003c/span\u003e (\u003cspan class=\"hljs-string\"\u003e\"vol\"\u003c/span\u003e);\r\n\r\n    \u003cspan class=\"hljs-comment\"\u003e// Set interval of values changed by arrow keys or shift + arrow keys.\u003c/span\u003e\r\n    intvDial.\u003cspan class=\"hljs-built_in\"\u003esetInterval\u003c/span\u003e (\u003cspan class=\"hljs-number\"\u003e5.0f\u003c/span\u003e);\r\n    intvDial.\u003cspan class=\"hljs-built_in\"\u003esetFineInterval\u003c/span\u003e (\u003cspan class=\"hljs-number\"\u003e1.0f\u003c/span\u003e);\r\n    sizeDial.\u003cspan class=\"hljs-built_in\"\u003esetInterval\u003c/span\u003e (\u003cspan class=\"hljs-number\"\u003e5.0f\u003c/span\u003e);\r\n    sizeDial.\u003cspan class=\"hljs-built_in\"\u003esetFineInterval\u003c/span\u003e (\u003cspan class=\"hljs-number\"\u003e1.0f\u003c/span\u003e);\r\n    posDial.\u003cspan class=\"hljs-built_in\"\u003esetInterval\u003c/span\u003e (\u003cspan class=\"hljs-number\"\u003e5.0f\u003c/span\u003e);\r\n    posDial.\u003cspan class=\"hljs-built_in\"\u003esetFineInterval\u003c/span\u003e (\u003cspan class=\"hljs-number\"\u003e1.0f\u003c/span\u003e);\r\n    pitchDial.\u003cspan class=\"hljs-built_in\"\u003esetInterval\u003c/span\u003e (\u003cspan class=\"hljs-number\"\u003e1.0f\u003c/span\u003e);\r\n    pitchDial.\u003cspan class=\"hljs-built_in\"\u003esetFineInterval\u003c/span\u003e (\u003cspan class=\"hljs-number\"\u003e0.1f\u003c/span\u003e);\r\n    gainDial.\u003cspan class=\"hljs-built_in\"\u003esetInterval\u003c/span\u003e (\u003cspan class=\"hljs-number\"\u003e1.0f\u003c/span\u003e);\r\n    gainDial.\u003cspan class=\"hljs-built_in\"\u003esetFineInterval\u003c/span\u003e (\u003cspan class=\"hljs-number\"\u003e0.1f\u003c/span\u003e);\r\n\r\n    \u003cspan class=\"hljs-built_in\"\u003eaddAndMakeVisible\u003c/span\u003e (sizeDial);\r\n    \u003cspan class=\"hljs-built_in\"\u003eaddAndMakeVisible\u003c/span\u003e (posDial);\r\n    \u003cspan class=\"hljs-built_in\"\u003eaddAndMakeVisible\u003c/span\u003e (intvDial);\r\n    \u003cspan class=\"hljs-built_in\"\u003eaddAndMakeVisible\u003c/span\u003e (widthDial);\r\n    \u003cspan class=\"hljs-built_in\"\u003eaddAndMakeVisible\u003c/span\u003e (pitchDial);\r\n    \u003cspan class=\"hljs-built_in\"\u003eaddAndMakeVisible\u003c/span\u003e (mixDial);\r\n    \u003cspan class=\"hljs-built_in\"\u003eaddAndMakeVisible\u003c/span\u003e (gainDial);\r\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"rehype-code-title\"\u003ePluginEditor.cpp\u003c/div\u003e\u003cpre\u003e\u003ccode class=\"hljs language-c++\"\u003e\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-type\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eJRGranularAudioProcessorEditor::resized\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e\r\n\u003c/span\u003e{\r\n    intvDial.\u003cspan class=\"hljs-built_in\"\u003esetBounds\u003c/span\u003e  (\u003cspan class=\"hljs-number\"\u003e30\u003c/span\u003e,  \u003cspan class=\"hljs-number\"\u003e30\u003c/span\u003e,  \u003cspan class=\"hljs-number\"\u003e80\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e95\u003c/span\u003e);\r\n    pitchDial.\u003cspan class=\"hljs-built_in\"\u003esetBounds\u003c/span\u003e (\u003cspan class=\"hljs-number\"\u003e130\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e30\u003c/span\u003e,  \u003cspan class=\"hljs-number\"\u003e80\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e95\u003c/span\u003e);\r\n    sizeDial.\u003cspan class=\"hljs-built_in\"\u003esetBounds\u003c/span\u003e  (\u003cspan class=\"hljs-number\"\u003e230\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e30\u003c/span\u003e,  \u003cspan class=\"hljs-number\"\u003e80\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e95\u003c/span\u003e);\r\n    posDial.\u003cspan class=\"hljs-built_in\"\u003esetBounds\u003c/span\u003e   (\u003cspan class=\"hljs-number\"\u003e330\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e30\u003c/span\u003e,  \u003cspan class=\"hljs-number\"\u003e80\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e95\u003c/span\u003e);\r\n    widthDial.\u003cspan class=\"hljs-built_in\"\u003esetBounds\u003c/span\u003e (\u003cspan class=\"hljs-number\"\u003e80\u003c/span\u003e,  \u003cspan class=\"hljs-number\"\u003e155\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e80\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e95\u003c/span\u003e);\r\n    mixDial.\u003cspan class=\"hljs-built_in\"\u003esetBounds\u003c/span\u003e   (\u003cspan class=\"hljs-number\"\u003e180\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e155\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e80\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e95\u003c/span\u003e);\r\n    gainDial.\u003cspan class=\"hljs-built_in\"\u003esetBounds\u003c/span\u003e  (\u003cspan class=\"hljs-number\"\u003e280\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e155\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e80\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e95\u003c/span\u003e);\r\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"embedding-a-custom-font\"\u003eEmbedding a custom font\u003c/h3\u003e\n\u003cp\u003eThe font embedded in JR-Granular is FuturaMedium.ttf font, which is automatically \u003ca href=\"https://support.apple.com/en-us/HT212587\"\u003einstalled\u003c/a\u003e in macOS.\u003c/p\u003e\n\u003cp\u003eLaunch Font Book application and look for Futura Medium Font.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/jr-granular/futura-medium.png\" alt=\"futura-medium.png\"\u003e\u003c/p\u003e\n\u003cp\u003eUse Finder application to show where this font is on your system. You can find the .ttc file in this way:\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/jr-granular/find-ttc.png\" alt=\"find-ttc.png\"\u003e\u003c/p\u003e\n\u003cp\u003eA .ttc file is like a collection of .ttf files, and in the case of Futura.ttc, it contains the following .ttf files:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eFutura-Medium.ttf\u003c/li\u003e\n\u003cli\u003eFutura-MediumItalic.ttf\u003c/li\u003e\n\u003cli\u003eFutura-Bold.ttf\u003c/li\u003e\n\u003cli\u003eFutura-CondensedMedium.ttf\u003c/li\u003e\n\u003cli\u003eFutura-CondensedExtraBold.ttf\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eSince we only want to use Futura-Medium.ttf, use the tool below to break down the .ttc file into multiple .ttf files and download only the Futura-Medium.ttf.\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://transfonter.org/ttc-unpack\"\u003eTransfonter\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cimg src=\"/images/jr-granular/transfonter.png\" alt=\"transfonter.png\"\u003e\u003c/p\u003e\n\u003cp\u003eCreate Resources directory, rename the downloaded Futura-Medium-01.ttf to FuturaMedium.ttf and place it under the directory.\u003c/p\u003e\n\u003cdiv class=\"rehype-code-title\"\u003eCommandLine\u003c/div\u003e\u003cpre\u003e\u003ccode class=\"hljs language-text\"\u003e$ mkdir Resources\r\n$ mv ~/Downloads/Futura-Medium-01.ttf Resources/FuturaMedium.ttf\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eAfter these settings, your directory structure should look something like this:\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/jr-granular/dir-structure.png\" alt=\"dir-structure.png\"\u003e\u003c/p\u003e\n\u003cp\u003eGo to the CMakeLists.txt, add juce_add_binary_data function and edit target_link_libraries function:\u003c/p\u003e\n\u003cdiv class=\"rehype-code-title\"\u003eCMakeLists.txt\u003c/div\u003e\u003cpre\u003e\u003ccode class=\"hljs language-diff\"\u003e\u003cspan class=\"hljs-addition\"\u003e+ juce_add_binary_data(BinaryData\u003c/span\u003e\r\n\u003cspan class=\"hljs-addition\"\u003e+     SOURCES\u003c/span\u003e\r\n\u003cspan class=\"hljs-addition\"\u003e+         Resources/FuturaMedium.ttf)\u003c/span\u003e\r\n\r\ntarget_link_libraries(\"${PROJECT_NAME}\"\r\n    PRIVATE\r\n\u003cspan class=\"hljs-addition\"\u003e+       BinaryData\u003c/span\u003e\r\n        juce::juce_audio_utils\r\n        juce::juce_recommended_config_flags\r\n        juce::juce_recommended_lto_flags\r\n        juce::juce_recommended_warning_flags)\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eFinally, add the following code in the constructor of the plugin editor.\u003c/p\u003e\n\u003cdiv class=\"rehype-code-title\"\u003epluginEditor.cpp\u003c/div\u003e\u003cpre\u003e\u003ccode class=\"hljs language-c++\"\u003eJRGranularAudioProcessorEditor::\u003cspan class=\"hljs-built_in\"\u003eJRGranularAudioProcessorEditor\u003c/span\u003e (JRGranularAudioProcessor\u0026#x26; p,\r\n                                                                juce::AudioProcessorValueTreeState\u0026#x26; state,\r\n                                                                juce::UndoManager\u0026#x26; um)\r\n...\r\n{\r\n    \u003cspan class=\"hljs-keyword\"\u003eauto\u003c/span\u003e futuraMedium = juce::Typeface::\u003cspan class=\"hljs-built_in\"\u003ecreateSystemTypefaceFor\u003c/span\u003e (BinaryData::FuturaMedium_ttf, \r\n                                                                 BinaryData::FuturaMedium_ttfSize);\r\n    juce::LookAndFeel::\u003cspan class=\"hljs-built_in\"\u003egetDefaultLookAndFeel\u003c/span\u003e().\u003cspan class=\"hljs-built_in\"\u003esetDefaultSansSerifTypeface\u003c/span\u003e (futuraMedium);\r\n...\r\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"building\"\u003eBuilding\u003c/h3\u003e\n\u003cp\u003eAll done! Build and run it on your DAW.\u003c/p\u003e\n\u003cdiv class=\"rehype-code-title\"\u003eCommandLine\u003c/div\u003e\u003cpre\u003e\u003ccode class=\"hljs language-text\"\u003e$ rm -rf build\r\n$ cmake -S . -B build -DCMAKE_BUILD_TYPE=Release\r\n$ cmake --build build --config Release\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cimg src=\"/images/jr-granular/finish.png\" alt=\"finish.png\"\u003e\u003c/p\u003e\n\u003ch2 id=\"closing\"\u003eClosing\u003c/h2\u003e\n\u003cp\u003eIn this tutorial I have explained the following:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003ehow to do the RNBO C++ export\u003c/li\u003e\n\u003cli\u003ehow to include the exported code into a JUCE project\u003c/li\u003e\n\u003cli\u003ehow to connect the exported code and JUCE using \u003ca href=\"https://docs.juce.com/master/classAudioProcessorValueTreeState.html\"\u003eAPVTS\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eIf there are any typos or better ways of the implementation, please do comment. Happy Coding!\u003c/p\u003e\n\u003ch2 id=\"references\"\u003eReferences\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://rnbo.cycling74.com/learn/using-the-audio-plugin-template\"\u003eUsing the Audio Plugin/Application Template\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://rnbo.cycling74.com/learn/programming-a-custom-ui-with-juce\"\u003eProgramming a Custom UI with JUCE\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://rnbo.cycling74.com/cpp\"\u003eRNBO C++ API Reference\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/Cycling74/gen-plugin-export\"\u003eCycling74/gen-plugin-export\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://docs.juce.com/master/index.html\"\u003eJUCE: Class Index\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e","title":"JR-Granular - JUCE \u0026 RNBO C++ Export","createdDate":"2022-11-02","updatedDate":"2022-11-23","thumbnail":"/images/jr-granular/jr-granular.png"}},"__N_SSG":true},"page":"/posts/[id]","query":{"id":"test"},"buildId":"8XfhgVM-SIvD1zCQSXMJe","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>